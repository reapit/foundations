import { Story, Canvas, Meta, ArgsTable } from '@storybook/addon-docs'
import { cx } from '@linaria/core'
import { Nav, NavItem } from './index'
import {
  elNavItemActive,
  elNavItemHideDesktop,
  elNavItemExpanded,
  elNavItemIcon,
  elNavIsDesktop,
  elNavItemSecondary,
} from './__styles__'
import { NavStateProvider, useNavState } from '../../hooks/use-nav-state'
import { MediaStateProvider } from '../../hooks/use-media-query'
import { Icon } from '../icon'
import { RenderHtmlMarkup } from '../../storybook/render-html-markup'
import { elMl4, elMlAuto, elMr2 } from '../../styles/spacing'
import { NavResponsive } from './nav-responsive'
import { Avatar, elAvatarSmall } from '../avatar'

<Meta title="Nav" component={NavResponsive} />

# Nav

The primary navigation all Reapit Marketplace applications should have.

## Basic Example

> If using React, we strongly recommend using the React Shorthand `NavResponsive` component as it will handle the mobile menu and sub items for you and give a better user experience.

In this basic example, no additional JS is added to the React generatated markup (see rendered markup section for the underlying elements).

Routing can be handled by way of an `href` attribute, an additional `el-nav-item-active` class can be toggled to display the currently selected menu item and an `el-nav-item-secondary` class can be added to align menu items with the right of the page rather than the center.

In this example, the menu will not expand in mobile - to enable this behaviour you will need to use some JavaScript - see below for the expanded classes you will need to toggle.

If you use a `SecondaryNav` component, you will need to add these options as `NavItem`s and toggle their visibilty with a simple media query in Mobile.

<Canvas>
  <Story name="Basic Example">
    <Nav>
      <NavItem>
        <Icon height="24px" width="100px" icon="reapitLogoInfographic" />
        <Icon
          className={cx(elMlAuto, elMr2, elNavItemHideDesktop)}
          icon="moreSolidSystem"
          fontSize="1.2rem"
          intent="default"
          onClick={() => console.log('Toggle Menu')}
        />
      </NavItem>
      <NavItem className={elNavItemActive} href="https://marketplace.reapit.cloud/apps">
        Apps
      </NavItem>
      <NavItem href="https://developers.reapit.cloud/analytics">Analytics</NavItem>
      <NavItem href="https://marketplace.reapit.cloud">Marketplace</NavItem>
    </Nav>
  </Story>
</Canvas>

<RenderHtmlMarkup component="Nav" story={['Basic Example']} />

## Basic Example Mobile Menu Open

In this example, changing the browser width to mobile will show the expanded mobile menu. You will need to use some JavaScript to toggle the `el-nav-item-expanded` class on the `NavItem` components on cllick of the more icon.

As per above if you use a `SecondaryNav` component, you will need to add these options as `NavItem`s and toggle their visibilty with the `elNavItemHideDesktop` class.

<Canvas>
  <Story name="Basic Example Mobile Menu Open">
    <Nav>
      <NavItem>
        <Icon height="24px" width="100px" icon="reapitLogoInfographic" />
        <Icon
          className={cx(elMlAuto, elMr2, elNavItemHideDesktop)}
          icon="moreSolidSystem"
          fontSize="1.2rem"
          intent="default"
          onClick={() => console.log('Toggle Menu')}
        />
      </NavItem>
      <NavItem className={cx(elNavItemActive, elNavItemExpanded)} href="https://marketplace.reapit.cloud/apps">
        Apps
      </NavItem>
      <NavItem className={cx(elNavItemExpanded, elNavItemHideDesktop)} href="https://marketplace.reapit.cloud">
        Option Hidden In Desktop
      </NavItem>
      <NavItem className={elNavItemExpanded} href="https://developers.reapit.cloud/analytics">
        Analytics
      </NavItem>
      <NavItem className={elNavItemExpanded} href="https://marketplace.reapit.cloud">
        Marketplace
      </NavItem>
    </Nav>
  </Story>
</Canvas>

<RenderHtmlMarkup component="Nav" story={['Basic Example Mobile Menu Open']} />

## React Usage

<ArgsTable component={NavResponsive} />

The `useNavState` hook will track the currrent state of the Nav and return both, the `navState` and a `setNavState` function. See the below inteface for `NavResponsiveOption` for an explanation of the code.

```ts
export interface NavResponsiveOption {
  itemIndex: number
  callback?: () => void
  text?: string
  href?: string
  subItems?: NavResponsiveOption[]
}
```

Practically the callback will be a dispatch to React Router, an update to `window.history` object or similar client side routing function. You may also wish to bind the callback to an application action for example below, we pass a `logout` function to the logout nav item.

You can override this behaviour by simply setting a `href` attribute to route to any url or path, for maximum flexibility.

We also introduce a second hook `useMediaQuery` which supplies an `isMobile` value - this enables to switch out elements based on a media query..

For the simple use case, the sub items are not required however, if you use a `SecondaryNav` component, you will need to add these as the `SecondaryNav` is hidden in mobile. The toggling of sub nav items in mobile is handled for you.

Finally, you can add avatar and app switcher options to the Nav by passing them as props to the `NavResponsive` component. See below for the accompanying interfaces.

```ts
export interface NavResponsiveAvatarOption {
  text?: string
  callback?: () => void
}

export interface NavResponsiveAppSwitcherOption {
  text?: string
  callback?: () => void
  iconUrl?: ReactNode
}
```

<Canvas>
  <Story name="React Usage">
    <NavStateProvider>
      <MediaStateProvider>
        <NavResponsive
          defaultNavIndex={1}
          appSwitcherOptions={[
            {
              text: 'AppMarket',
              callback: () => console.log('Navigating'),
              iconUrl: <Icon icon="reapitLogoSmallInfographic" />,
            },
            {
              text: 'DevPortal',
              callback: () => console.log('Navigating'),
              iconUrl: <Icon icon="reapitLogoSmallInfographic" />,
            },
          ]}
          avatarText="JD"
          avatarOptions={[
            {
              text: 'Settings',
              callback: () => console.log('Navigating'),
            },
            {
              text: 'Profile',
              callback: () => console.log('Navigating'),
            },
            {
              text: 'Log Out',
              callback: () => console.log('Navigating'),
            },
          ]}
          options={[
            {
              itemIndex: 0,
              callback: () => console.log('Navigating'),
            },
            {
              itemIndex: 1,
              callback: () => console.log('Navigating'),
              text: 'Apps',
              subItems: [
                {
                  itemIndex: 0,
                  callback: () => console.log('Navigating'),
                  text: 'App List',
                },
                {
                  itemIndex: 1,
                  callback: () => console.log('Navigating'),
                  text: 'Create App',
                },
              ],
            },
            {
              itemIndex: 2,
              callback: () => console.log('Navigating'),
              text: 'Analytics',
              subItems: [
                {
                  itemIndex: 2,
                  callback: () => console.log('Navigating'),
                  text: 'Hits Per Day',
                },
                {
                  itemIndex: 3,
                  callback: () => console.log('Navigating'),
                  text: 'Weekly Hits',
                },
              ],
            },
            {
              itemIndex: 3,
              href: 'https://marketplace.reapit.cloud',
              text: 'Marketplace',
            },
            {
              itemIndex: 4,
              callback: () => console.log('Logging out'),
              iconId: 'profileMenu',
              isSecondary: true,
              text: 'Logout',
            },
          ]}
        />
      </MediaStateProvider>
    </NavStateProvider>
  </Story>
</Canvas>

<RenderHtmlMarkup component="Nav" story={['React Usage']} />
