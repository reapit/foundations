import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks'
import { cx } from '@linaria/core'
import { Table, Cell, Row } from './index'
import {
  TableHeadersRow,
  TableHeader,
  TableRow,
  TableCell,
  TableExpandableRowTriggerCell,
  TableExpandableRow,
  TableRowContainer,
} from './molecules'
import { Icon } from '../icon'
import { RenderHtmlMarkup } from '../../storybook/render-html-markup'
import { Grid, Col, elSpan6, elOffset7 } from '../grid'
import { Molecule } from '../layout'
import { Subtitle } from '../typography'
import { InputGroup } from '../input-group'
import { Button, ButtonGroup } from '../button'
import { StatusIndicator } from '../status-indicator'
import { elMlAuto } from '../../styles/spacing'

<Meta title="Table" component={Table} />

# Table

## Summary

The Table component can be used in 2 main ways within

1. Building a table from the Table molecule components, e.g. `TableRow`, `TableCell`, etc
1. Using the React shorthand and supplying a `rows` prop with data. This way offers advantages such as not needing to manage the state for the expandable rows.

There are two visual styles for the table, dependant on screen width.

1. Normal
1. Narrow - i.e. where the screen is too small for the content on a conventional screen - below 1024px.

On the Narrow version, the table's grid switches to a 2 column layout. There are additional modifiers that can then be
applied to cells when it's in narrow mode, e.g. showing the header within the cell and whether a cell should be full width.

## Basic Usage

For Non React users and React users with basic requirements, you can just use `Table`, `TableHeadersRow`, `TableHeader`, `TableRow` and `TableCell` components as presentational components to render your content. See the rendered Markup for non-React users as always.

For React users, the table has a number of freatures that you may find useful to present your data, like an expandable call to action container. These do fall under the banner of "Advanced usage", so in most cases, just use the basic table component classes and render children to get the desired functionality for your application.

<Canvas>
  <Story name="Basic Usage">
    <Table>
      <TableHeadersRow>
        <TableHeader>First Header</TableHeader>
        <TableHeader>Second Header</TableHeader>
        <TableHeader>Third Header</TableHeader>
      </TableHeadersRow>
      <TableRow>
        <TableCell>First Column</TableCell>
        <TableCell>Second Column</TableCell>
        <TableCell>Third Column</TableCell>
      </TableRow>
      <TableRow>
        <TableCell>First Column</TableCell>
        <TableCell>Second Column</TableCell>
        <TableCell>Third Column</TableCell>
      </TableRow>
    </Table>
  </Story>
</Canvas>

<RenderHtmlMarkup component="Table" story="Basic Usage" />

`Table` only renders children, unless the `rows` prop is supplied as a React shorthand.

## Basic Customisation - Table Cells

`TableCell` renders children, but also accepts some other props. Any other props given that aren't listed below are are applied to the underlying `div` element.

Props available for the React version of the component;

<ArgsTable of={TableCell} />

To explain these props;

- `icon` Adds an icon at the start of the cell
- `darkText` Turns the cell's text colour to black to make a cell's content appear bold
- `narrowLabel` Set a label that will be shown within a cell, when the table is in narrow view mode. **You may need to make your screen smaller to see this story.** Non-React users, note that a data attribute is set `data-narrow-label`.
- `narrowIsFullWidth` If set, this prop will ensure that in narrow view mode the cell takes up both columns of a table.
- `narrowOrder` If you require to change the order of your cells in the mobile/narrow view, you can use the `narrowOrder` property to change the cell's order in the column. The order can be specified between 1 and 12. For non-React users you can also use the classes `el-table-cell-narrow-order-1` through to `el-table-cell-narrow-order-12`.

As always, these modifiers map to CSS classes for non React users.

In the example below, you can see examples of all the different flavours of `TableCell` and modifier. It is worth re-sizing the screen to see the 'narrow' behaviour.

<Canvas>
  <Story name="Basic Customisation - Table Cells">
    <Table>
      <TableHeadersRow>
        <TableHeader>Property</TableHeader>
        <TableHeader>Customer</TableHeader>
        <TableHeader>Client A/C</TableHeader>
        <TableHeader>Description</TableHeader>
        <TableHeader>Request Date</TableHeader>
        <TableHeader>Amount</TableHeader>
        <TableHeader>Payment Status</TableHeader>
        <TableHeader>
          <Icon icon="editSystem" fontSize="1.2rem" />
        </TableHeader>
      </TableHeadersRow>
      <TableRowContainer>
        <TableRow>
          <TableCell darkText icon="homeSystem" narrowIsFullWidth>
            Mt Ash Jacket Brassey Road
          </TableCell>
          <TableCell narrowLabel="Name Customer" icon="usernameSystem">
            Mr Johnny Corrigan
          </TableCell>
          <TableCell narrowLabel="Account">Alternate Lettings Client Acc</TableCell>
          <TableCell narrowLabel="Type">Tenant Payment Request</TableCell>
          <TableCell narrowLabel="Request Date">19 Apr 2021</TableCell>
          <TableCell darkText narrowLabel="Amount">
            £50.00
          </TableCell>
          <TableCell narrowLabel="Status">
            {' '}
            <StatusIndicator intent="critical" /> Pending
          </TableCell>
        </TableRow>
      </TableRowContainer>
    </Table>
  </Story>
</Canvas>

<RenderHtmlMarkup component="Table" story="Basic Customisation - Table Cells" />

## Trigger Cells

Typically with a table, you will want to perform an action on the data as displayed in a given table row. We offer two distinct UI patterns to achieve this;

1. A collapsable container - used when there is more than one call to action required or if there is some more complex behaviour to render like an edit form.
2. A call to action cell - used when there is a single action to perform, for example a button that triggers a navigation or a dialogue window to open.

The below two examples show the additional markup required firstly, to show an expandable container and secondly, a call to action cell.

For the call to action, you will need to add your own action to toggle the `isOpen` modifier or the underlying active class for non-React users.

<Canvas>
  <Story name="Expandable Content
  ">
    <Table data-num-columns-excl-expandable-row-trigger-col="7" data-has-expandable-action>
      <TableHeadersRow>
        <TableHeader>Property</TableHeader>
        <TableHeader>Customer</TableHeader>
        <TableHeader>Client A/C</TableHeader>
        <TableHeader>Description</TableHeader>
        <TableHeader>Request Date</TableHeader>
        <TableHeader>Amount</TableHeader>
        <TableHeader>Payment Status</TableHeader>
        <TableHeader>
          <Icon icon="editSystem" fontSize="1.2rem" />
        </TableHeader>
      </TableHeadersRow>
      <TableRowContainer>
        <TableRow>
          <TableCell darkText icon="homeSystem" narrowIsFullWidth>
            Mt Ash Jacket Brassey Road
          </TableCell>
          <TableCell narrowLabel="Name Customer" icon="usernameSystem">
            Mr Johnny Corrigan
          </TableCell>
          <TableCell narrowLabel="Account">Alternate Lettings Client Acc</TableCell>
          <TableCell narrowLabel="Type">Tenant Payment Request</TableCell>
          <TableCell narrowLabel="Request Date">19 Apr 2021</TableCell>
          <TableCell darkText narrowLabel="Amount">
            £50.00
          </TableCell>
          <TableCell narrowLabel="Status">
            {' '}
            <StatusIndicator intent="critical" /> Pending
          </TableCell>
          <TableExpandableRowTriggerCell isOpen />
        </TableRow>
        <TableExpandableRow isOpen>
          <Molecule>
            <Subtitle>Form Example</Subtitle>
            <Grid>
              <Col>
                <InputGroup icon="homeSystem" label="Please enter an address" type="text" />
              </Col>
              <Col>
                <InputGroup label="Please enter your email" type="text" />
              </Col>
              <Col />
              <Col>
                <ButtonGroup className={elMlAuto}>
                  <Button chevronRight intent="primary">
                    Send
                  </Button>
                </ButtonGroup>
              </Col>
            </Grid>
          </Molecule>
        </TableExpandableRow>
      </TableRowContainer>
    </Table>
  </Story>
</Canvas>

<RenderHtmlMarkup component="Table" story="Expandable Content
" />

## Advanced Customisation - React

Props available for the React version of the component;

<ArgsTable of={Table} />

To explain these props (for non React / basic usage, skip this section);

- `rows` A list of table rows - when using this React shorthand, the label is used as the header and value / or children can be specified to render content. See table cells below for other options.
- `numberColums` The table defaults to fill the available space evenly for each column. If you want to customise this, increase the number of table columns and add a column span modifier as a className to your table cell. E.g. by increasing the number of columns by one more than the number of cells then applying an `elSpan2` className to one cell, this cell will span two columns.
- `indexExpandedRow` See expandable content below. This allows you to programatically toggle open a row's expandable content by passing the row index as a prop. The default React behaviour handles a toggle onClick however, you may wish to override this for example, when you wish to close a row on an API callback or form submission.
- `setIndexExpandedRow` See above, if you are using your own expanded row state, pass your setter (eg a React useState setter), to the component so that the on click expansion keeps your `indexExpandedRow` in sync.

## Table built from molecule components

## React Shorthand

Simply supply a `rows` prop, and no children, to use the Table component like this.

<Canvas>
  <Story name="React shorthand usage">
    <Table
      rows={[
        {
          cells: [
            {
              label: 'Property',
              value: 'Mt Ash Jacket, Brassey Road',
              icon: 'homeSystem',
              cellHasDarkText: true,
              narrowTable: { showLabel: true },
            },
            {
              label: 'Customer',
              value: 'Mr Johnny Corrigan',
              icon: 'usernameSystem',
              narrowTable: { showLabel: true },
            },
            {
              label: 'Client A/C',
              value: 'Alternate Lettings Client Acc',
            },
            {
              label: 'Description',
              value: 'Tenant Payment Request',
            },
            {
              label: 'Request Date',
              value: '19 Apr 2021',
              narrowTable: { showLabel: true },
            },
            {
              label: 'Amount',
              value: '£50.00',
              cellHasDarkText: true,
            },
            {
              label: 'Payment Status',
              value: 'Not Requested',
              children: (
                <>
                  <StatusIndicator intent="danger" /> Not Requested
                </>
              ),
            },
          ],
          expandableContent: { content: <p>I am the content that is only visible when expanded</p> },
        },
        {
          cells: [
            {
              label: 'Property',
              value: 'Property Name, Road Name',
              icon: 'homeSystem',
              cellHasDarkText: true,
              narrowTable: { showLabel: true },
            },
            {
              label: 'Customer',
              value: 'Mrs Davina Corrigan',
              icon: 'usernameSystem',
              narrowTable: { showLabel: true },
            },
            {
              label: 'Client A/C',
              value: 'Alternate Lettings Client Acc',
            },
            {
              label: 'Description',
              value: 'Another descriptions',
            },
            {
              label: 'Request Date',
              value: '23rd Apr 2021',
              narrowTable: { showLabel: true },
            },
            {
              label: 'Amount',
              value: '£665.21',
              cellHasDarkText: true,
            },
            {
              label: 'Payment Status',
              value: 'Pending',
              children: (
                <>
                  <StatusIndicator intent="critical" /> Pending
                </>
              ),
            },
          ],
          expandableContent: { content: <p>I am more content that is only visible when the 2nd row is expanded</p> },
        },
      ]}
    />
  </Story>
</Canvas>

## The `rows` prop

<ArgsTable of={Table} />

```ts
type Row = {
  cells: Cell[]
  /* The content that should be hidden within the expandable row underneath this row */
  expandableContent: ReactNode
}
```

```ts
type Cell = {
  /* the label of the cell (AKA, the header) */
  label: string
  /* the value of the cell */
  value: string
  /* if supplied, children will be rendered in place of value. If a value and children are both supplied, only children will be rendered */
  children: ReactNode
  /* an icon to go within the cell */
  icon?: IconNames
  /* whether to make the text in the cell darker */
  cellHasDarkText?: boolean
  /* properties that apply when the table is in narrow view mode */
  narrowTable?: {
    showLabel?: boolean
    isFullWidth?: boolean
    order?: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12
  }
}
```
