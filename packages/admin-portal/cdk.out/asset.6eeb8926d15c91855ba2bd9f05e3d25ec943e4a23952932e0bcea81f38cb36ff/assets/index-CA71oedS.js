import{r as o,j as e,aa as E,ab as S,ao as c,ad as u,ap as b,as as g,ac as re,au as le,av as _,al as w,af as j,ai as X,ag as oe,ah as de,aj as pe,a5 as T,ae as H,X as ce,W as ue,am as he,a7 as xe,an as me}from"./vendor-ZH71Hs13.js";import{u as L,t as J}from"./index.esm-Ch-ie6LE.js";import{f as je}from"./index-C-eCv2z-.js";import{u as N,r as f,g as D,G as R,a as v,U as A,o as be}from"./index-CIzY3aXN.js";import{o as K}from"./navigation-yBndQIhU.js";import{u as y}from"./use-reapit-update-DbPmNVFV.js";import{C as fe}from"./create-subscriptions-LJz5OW8E.js";import{a as ge}from"./use-permissions-state-DOqpaw2Q.js";import{S as Ce}from"./index-Co6JqKJd.js";import"./FileSaver.min-BZwjJ9VL.js";const ve=(a,s)=>()=>{const t=s(je(a,500));return()=>t.unsubscribe()},Ae=({setAppsFilters:a})=>{var l;const{register:s,watch:t}=L();o.useEffect(ve(a,t),[]);const[i]=N({reapitConnectBrowserSession:f,action:D[R.getAppCategories],queryParams:{pageSize:50}});return e.jsx("form",{children:e.jsxs(E,{className:S,children:[e.jsx(c,{children:e.jsx(u,{...s("searchTerm"),label:"App or Developer Name",type:"search"})}),e.jsx(c,{children:e.jsx(u,{...s("companyName"),label:"Company Name",type:"search"})}),e.jsx(c,{children:e.jsx(u,{...s("id"),label:"App Id",type:"search"})}),e.jsx(c,{children:e.jsx(u,{...s("registeredFrom"),label:"Registered From",type:"date"})}),e.jsx(c,{children:e.jsx(u,{...s("registeredTo"),label:"Registered To",type:"date"})}),e.jsx(c,{children:e.jsx(u,{...s("publicListedDateFrom"),label:"Publicly Listed From",type:"date"})}),e.jsx(c,{children:e.jsx(u,{...s("publicListedDateTo"),label:"Publicly Listed To",type:"date"})}),e.jsx(c,{children:e.jsxs(u,{children:[e.jsx(b,{children:"In Public AppMarket"}),e.jsx(g,{...s("isPublic"),hasGreyBg:!0,options:[{id:"option-public-all",value:"",text:"All",isChecked:!0},{id:"option-public-true",value:"true",text:"Public",isChecked:!1},{id:"option-public-false",value:"false",text:"Private",isChecked:!1}]})]})}),e.jsx(c,{children:e.jsxs(u,{children:[e.jsx(b,{children:"Integration or AC Enabled"}),e.jsx(g,{...s("isDirectApi"),hasGreyBg:!0,options:[{id:"option-integration-all",value:"",text:"All",isChecked:!0},{id:"option-integration-true",value:"true",text:"Integration",isChecked:!1},{id:"option-integration-false",value:"false",text:"AC App",isChecked:!1}]})]})}),e.jsx(c,{children:e.jsxs(u,{children:[e.jsx(b,{children:"Publicly Listed"}),e.jsx(g,{...s("isListed"),hasGreyBg:!0,options:[{id:"option-listed-all",value:"",text:"All",isChecked:!0},{id:"option-listed-true",value:"true",text:"Listed",isChecked:!1},{id:"option-listed-false",value:"false",text:"Development",isChecked:!1}]})]})}),e.jsx(c,{children:e.jsxs(u,{children:[e.jsx(b,{children:"Is Charged Consumption"}),e.jsx(g,{...s("isChargedConsumption"),hasGreyBg:!0,options:[{id:"option-consumption-all",value:"",text:"All",isChecked:!0},{id:"option-consumption-true",value:"true",text:"Charged",isChecked:!1},{id:"option-consumption-false",value:"false",text:"Free",isChecked:!1}]})]})}),i&&e.jsx(e.Fragment,{children:e.jsx(re,{children:e.jsxs(u,{children:[e.jsx(b,{children:"Categories"}),e.jsx(le,{id:"category",...s("category"),options:(l=i.data)==null?void 0:l.map(({name:r,id:d})=>({name:r,value:d})),defaultValues:[]})]})})})]})})},ye=["application.install","application.uninstall"],Ie=["SBOX"],ke=a=>()=>{a(1)},we=a=>!!a.filter(s=>{const{topicIds:t,customerIds:i,active:l}=s,r=!!(t!=null&&t.filter(n=>!ye.includes(n)).length),d=!!(!(i!=null&&i.length)||i!=null&&i.filter(n=>!Ie.includes(n)).length);return r&&d&&l}).length,Te=(a,s)=>()=>{if(a){const t=we((a==null?void 0:a._embedded)??[]);s(t?2:3)}else s(0)},Pe=({appId:a,status:s})=>{const[t,i]=o.useState(s??0),[l]=N({reapitConnectBrowserSession:f,action:D[R.getWebhookSubscriptions],queryParams:{applicationId:a,pageSize:999,active:!0},fetchWhenTrue:[a&&t===1]});return o.useEffect(Te(l,i),[l]),t===2?e.jsx(_,{isFlexAlignCenter:!0,children:e.jsx(w,{hasGreyText:!0,hasNoMargin:!0,children:"AWS Customers Only"})}):t===3?e.jsx(_,{isFlexAlignCenter:!0,children:e.jsx(w,{hasGreyText:!0,hasNoMargin:!0,children:"All Customers"})}):e.jsx(j,{intent:"primary",loading:t===1,disabled:t===1,onClick:ke(i),children:"Check AWS Only"})},Fe=(a,s)=>({isFeatured:t})=>{(t==="FEATURED"?a:s)()},Ee=(a,s)=>()=>{s&&a()},Se=(a,s,t)=>()=>{const i=t(Fe(a,s));return()=>i.unsubscribe()},Le=({appIdFeatured:a,apps:s,appsRefresh:t})=>{var m,C;const{register:i,watch:l}=L(),r=!!((C=(m=s==null?void 0:s.data)==null?void 0:m.find(I=>I.id===a))!=null&&C.isFeatured),[,,d,n]=y({reapitConnectBrowserSession:f,action:v[A.featureApp],method:"PUT",uriParams:{appId:a}}),[,,h,x]=y({reapitConnectBrowserSession:f,action:v[A.unFeatureApp],method:"DELETE",uriParams:{appId:a}});return o.useEffect(Ee(t,n||x),[n,x]),o.useEffect(Se(d,h,l),[d,h]),e.jsx("form",{children:e.jsx(E,{className:X,children:e.jsxs(c,{children:[e.jsx(b,{children:"Is Featured In AppMarket"}),e.jsx(g,{...i("isFeatured"),hasGreyBg:!0,options:[{id:"option-featured-true",value:"FEATURED",text:"Featured",isChecked:!!r},{id:"option-featured-false",value:"NOT_FEATURED",text:"Not Featured",isChecked:!r}]})]})})})},Ne=a=>({fixedApiConsumptionCost:s})=>{a({fixedApiConsumptionCost:s==="FREE"?0:void 0})},De=(a,s)=>()=>{s&&a()},Re=(a,s)=>()=>{const t=s(Ne(a));return()=>t.unsubscribe()},Be=({appIdConsumption:a,apps:s,appsRefresh:t})=>{var h,x;const{register:i,watch:l}=L(),r=((x=(h=s==null?void 0:s.data)==null?void 0:h.find(m=>m.id===a))==null?void 0:x.fixedApiConsumptionCost)!==0,[,,d,n]=y({reapitConnectBrowserSession:f,action:v[A.updateApp],method:"PUT",uriParams:{appId:a}});return o.useEffect(De(t,!!n),[n]),o.useEffect(Re(d,l),[d]),e.jsx("form",{children:e.jsx(E,{className:X,children:e.jsxs(c,{children:[e.jsx(b,{children:"API Consumption Charges"}),e.jsx(g,{...i("fixedApiConsumptionCost"),hasGreyBg:!0,options:[{id:"option-free-false",value:"NOT_FREE",text:"Pays for API consumption",isChecked:r},{id:"option-free-true",value:"FREE",text:"API consumption free",isChecked:!r}]})]})})})},Ue=a=>s=>{a({sendInternalInstallNotification:s.target.value==="enable"})},Me=({appId:a,sendInternalInstallNotification:s})=>{const[t,,i]=y({reapitConnectBrowserSession:f,action:v[A.updateApp],method:"PUT",uriParams:{appId:a},headers:{"Api-Version":"latest"}});return e.jsxs(e.Fragment,{children:[e.jsx(b,{children:"Support Notification"}),e.jsx(g,{name:`support-notification-${a}`,options:[{id:"enable-support-notification"+a,isChecked:s,text:"Enabled",value:"enable"},{id:"disable-support-notification"+a,isChecked:!s,text:"Disabled",value:"disable"}],disabled:t,onChange:Ue(i)})]})};var Q={appEnv:"development",sentryDsn:"",connectClientId:"76q6dqj28batdlespqc36urn8b",connectOAuthUrl:"https://connect.dev.paas.reapit.cloud",connectUserPoolId:"eu-west-2_kiftR4qFc",platformApiUrl:"https://platform.dev.paas.reapit.cloud",developerPortalUri:"https://developers.dev.paas.reapit.cloud",appMarketUri:"https://marketplace.dev.paas.reapit.cloud"};const Ge=(a,s,t)=>()=>{t&&(a(),s(null))},Oe=(a,s,t,i)=>()=>{i&&(a(),s(null),t())},$e=(a,s,t)=>()=>{t&&(s(t),a())},qe=(a,s,t,i)=>()=>{i&&(a(i),s(null),t(null))},ze=(a,s,t,i)=>()=>{i&&(a(i),s(null),t(null))},We=(a,s,t,i)=>()=>{i&&(a(i),s(null),t(null))},Ve=({apps:a,appsRefresh:s})=>{var G,O,$;const{Modal:t,openModal:i,closeModal:l}=oe(),{hasReadAccess:r}=ge(),[d,n]=o.useState(null),[h,x]=o.useState(null),[m,C]=o.useState(null),[I,P]=o.useState(null),[Z,B]=o.useState(null),U=(O=(G=a==null?void 0:a.data)==null?void 0:G.find(F=>F.id===d))==null?void 0:O.name,[,,ee,M]=y({reapitConnectBrowserSession:f,action:v[A.deleteApp],method:"DELETE",uriParams:{appId:d}});return o.useEffect(Oe(s,n,l,M),[M]),($=a==null?void 0:a.data)!=null&&$.length?e.jsxs("div",{className:S,children:[e.jsx(de,{children:"Total Apps"}),e.jsx(w,{hasGreyText:!0,children:a.totalCount}),e.jsx(pe,{indexExpandedRow:Z,setIndexExpandedRow:B,rows:a.data.map(({name:F,id:p,summary:ae,developer:se,isListed:q,isDirectApi:z,isFeatured:W,created:te,developerId:ie,publicListedDate:V,limitToClientIds:k,sendInternalInstallNotification:ne})=>({cells:[{label:"App Name",value:F??"",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"AppId",value:p??"",narrowTable:{showLabel:!0}},{label:"Summary",value:ae??"",narrowTable:{showLabel:!0}},{label:"Developer Name",value:se??"",narrowTable:{showLabel:!0}},{label:"Listed",value:e.jsx(T,{icon:q?"check":"close",intent:q?"success":"danger"}),narrowTable:{showLabel:!0}},{label:"Integration",value:e.jsx(T,{icon:z?"check":"close",intent:z?"success":"danger"}),narrowTable:{showLabel:!0}},{label:"Featured",value:e.jsx(T,{icon:W?"check":"close",intent:W?"success":"danger"}),narrowTable:{showLabel:!0}},{label:"Created",value:J(te)??"",narrowTable:{showLabel:!0}},{label:"Publicly Listed",value:V?J(V):"-",narrowTable:{showLabel:!0}},{label:"Public",value:e.jsx(T,{icon:Array.isArray(k)&&k.length>0?"close":"check",intent:Array.isArray(k)&&k.length>0?"danger":"success"}),narrowTable:{showLabel:!0}}],expandableContent:{content:e.jsxs(e.Fragment,{children:[e.jsxs(H,{alignment:"center",children:[e.jsx(j,{intent:"default",onClick:K(`${Q.appMarketUri}/apps/${p}`),children:"View in AppMarket"}),e.jsx(j,{intent:"default",disabled:r,onClick:K(`${Q.developerPortalUri}/apps/${p}`),children:"View in DevPortal"}),e.jsx(Pe,{appId:p??""}),e.jsx(j,{onClick:ze(P,x,C,p),intent:"primary",disabled:r,children:"Toggle Subscription"}),e.jsx(j,{intent:"primary",disabled:r,onClick:qe(x,P,C,p),children:"Togggle Featured"}),e.jsx(j,{intent:"primary",disabled:r,onClick:We(C,P,x,p),children:"Togggle API Consumption"}),e.jsx(j,{type:"button",intent:"danger",disabled:r,onClick:$e(i,n,p),children:"Delete"})]}),h&&h===p&&e.jsx(Le,{appIdFeatured:h,apps:a,appsRefresh:s}),I&&I===p&&e.jsx(fe,{appId:p,developerId:ie,subscriptionType:"applicationListing"}),m&&m===p&&e.jsx(Be,{appIdConsumption:m,apps:a,appsRefresh:s}),!r&&e.jsx(Me,{appId:p,sendInternalInstallNotification:ne||!1})]})}}))}),e.jsxs(t,{title:`Confirm ${U} Deletion`,children:[e.jsxs(w,{children:["Are your sure you want to remove the app \u2018",U,"\u2019? By clicking \u2018delete\u2019 it will remove all app data including all revisions and listings."]}),e.jsxs(H,{alignment:"center",children:[e.jsx(j,{intent:"primary",onClick:l,children:"Cancel"}),e.jsx(j,{intent:"danger",onClick:Ge(ee,B,d),children:"Confirm"})]})]})]}):e.jsx("div",{className:S,children:e.jsx(ce,{isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No results found for your selected filters"})})},Y=()=>{var m;const[a,s]=o.useState({}),t=be({...a,category:(m=a.category)==null?void 0:m.split(",")}),[i,l]=o.useState(1),[r,d]=o.useState(12),[n,h,,x]=N({reapitConnectBrowserSession:f,action:D[R.getApps],queryParams:{...t,pageNumber:i,pageSize:r}});return e.jsxs(ue,{children:[e.jsx(he,{children:"Apps Management"}),e.jsx(Ae,{setAppsFilters:s,apps:n}),h?e.jsx(xe,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{area:"APPS",data:n,setPageSize:d}),e.jsx(Ve,{apps:n,appsRefresh:x}),e.jsx(me,{callback:l,currentPage:i,numberPages:Math.ceil(((n==null?void 0:n.totalCount)??1)/((n==null?void 0:n.pageSize)??1))})]})]})};export{Y as AppsPage,Y as default};
