import{j as e,a7 as D,y as E,g as u,L as b,ae as j,aj as L,z as g,i as w,af as F,at as k,au as N,ab as P,am as G,an as f,ap as M,aq as y,F as R,r as W,W as H,ac as U,B as Y}from"./vendor-troV5kp-.js";import{u as $,d as z}from"./index.esm-zVN26rm4.js";import{f as V}from"./developers-gaNWywzP.js";import{u as v,r as I,g as T,G as C}from"./index-7tW5-Pg7.js";import{S as _}from"./index-1k5r5oX4.js";import"./constants-PNvbKeey.js";import"./FileSaver.min-JSyqwKbI.js";const J=({setUsageFilters:s,apps:l,installations:t})=>{var x,c;const{register:r,handleSubmit:i,getValues:p}=$({mode:"all"}),{developerId:d,month:m,appId:o}=p();return e.jsx("form",{onChange:i(s),children:e.jsxs(D,{hasMargin:!0,children:[e.jsxs(E,{children:[e.jsx(u,{children:"Filters"}),e.jsx(b,{hasGreyText:!0,children:"Apply a filter to get started. Developer and month are required by default."})]}),e.jsx(j,{children:e.jsx(L,{label:"Company",id:"developer-search-box",...r("developerId"),getResults:a=>V({company:a,status:"confirmed"}).then(n=>(n==null?void 0:n.data)??[]),getResultLabel:a=>`${a.company} -  ${a.name}`,getResultValue:a=>a.id??"",placeholder:"Search developer organisations"})}),e.jsx(j,{children:e.jsx(g,{...r("month"),label:"Month",type:"month",defaultValue:z(new Date).subtract(1,"month").format("YYYY-MM")})}),e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(w,{children:"App"}),e.jsxs(F,{...r("appId"),disabled:!d||!m||!l,children:[e.jsx("option",{value:"",children:"Please Select"}),(x=l==null?void 0:l.data)==null?void 0:x.map(({id:a,name:n})=>e.jsx("option",{value:a,children:n},a))]})]})}),e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(w,{children:"Customer"}),e.jsxs(F,{...r("customerId"),disabled:!d||!m||!o||!t,children:[e.jsx("option",{value:"",children:"Please Select"}),(c=t==null?void 0:t.data)==null?void 0:c.map(({customerName:a,id:n,client:h})=>e.jsxs("option",{value:h,children:[a," (Code: ",h,")"]},n))]})]})})]})})},B="three-col-table",K=({billing:s})=>{var t,r,i,p;const l=((r=(t=s==null?void 0:s.services)==null?void 0:t.find(d=>d.name==="API Requests"))==null?void 0:r.items)??[];return l.length?e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsxs(N,{children:[e.jsx(u,{children:"Billable Amount"}),e.jsxs(b,{hasGreyText:!0,children:["\xA3",(i=s==null?void 0:s.totalCost)==null?void 0:i.toFixed(2).padStart(2,"0")]})]}),e.jsxs(N,{children:[e.jsx(u,{children:"Actual Cost"}),e.jsxs(b,{hasGreyText:!0,children:["\xA3",(p=s==null?void 0:s.actualCost)==null?void 0:p.toFixed(2).padStart(2,"0")]})]})]}),e.jsx(u,{children:"Breakdown"}),e.jsx(P,{rows:l.map(({name:d,amount:m,cost:o,itemCount:x,items:c})=>({cells:[{label:"Entity Name",value:d??"",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Total Number Calls",value:String(m)??"",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Total Cost",value:o?`\xA3${o.toFixed(2).padStart(2,"0")}`:"\xA30",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Total Number Endpoints",value:String(x)??"",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}}],expandableContent:{content:e.jsx(e.Fragment,{children:e.jsxs(P,{children:[e.jsxs(G,{className:B,children:[e.jsx(f,{children:"Endpoint Name"}),e.jsx(f,{children:"Endpoint Number Calls"}),e.jsx(f,{children:"Endpoint Cost"})]}),c==null?void 0:c.map(({name:a,amount:n,cost:h})=>e.jsxs(M,{className:B,children:[e.jsx(y,{children:a}),e.jsx(y,{children:n}),e.jsx(y,{children:h?`\xA3${h}`:"\xA30"})]},a))]})})}}))})]}):e.jsx("div",{children:e.jsx(R,{isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No results found for your selected filters"})})},A=()=>{var h,S;const[s,l]=W.useState({}),{month:t,developerId:r,appId:i,customerId:p}=s,d=i?{applicationId:i}:{},m=p?{customerId:p}:{},[o,x]=v({reapitConnectBrowserSession:I,action:T[C.getBillingDataByMonth],queryParams:{developerId:r,type:"trafficEvents",...d,...m},uriParams:{month:t},headers:{"api-version":"2"},fetchWhenTrue:[t&&r]}),[c]=v({reapitConnectBrowserSession:I,action:T[C.getApps],queryParams:{developerId:r,pageSize:999},fetchWhenTrue:[t&&r]}),[a]=v({reapitConnectBrowserSession:I,action:T[C.getInstallations],queryParams:{appId:i,isInstalled:!0,pageSize:999},fetchWhenTrue:[t&&r&&i]}),n=((S=(h=o==null?void 0:o.services)==null?void 0:h.find(q=>q.name==="API Requests"))==null?void 0:S.items)??[];return e.jsxs(H,{children:[e.jsx(U,{children:"API Usage"}),e.jsx(J,{setUsageFilters:l,apps:c,installations:a}),e.jsx(_,{area:"BILLING",data:n}),x?e.jsx(Y,{}):e.jsx(K,{billing:o})]})};export{A as UsagePage,A as default};
