import{r as c,a9 as _,j as e,W as f,ac as N,a7 as v,a8 as p,ae as U,aj as k,B as A,ab as G,av as F,L as M,k as V,c as h,ad as B}from"./vendor-troV5kp-.js";import{o as Q,u as $,r as d,g as H,G as z,a as W,U as Y}from"./index-7tW5-Pg7.js";import{u as q,a as J}from"./use-permissions-state-3iXP9x9E.js";import{u as K}from"./index.esm-zVN26rm4.js";import{u as X}from"./use-reapit-update-Z5Casrho.js";import{f as Z}from"./developers-gaNWywzP.js";import"./constants-PNvbKeey.js";const ee=a=>{switch(a){case"PROVISIONING":return"primary";case"SUCCEEDED":case"COMPLETED":return"success";case"IN_PROGRESS":case"QUEUED":return"neutral";case"FAILED":case"DELETING":case"DELETED":case"FAILED_TO_PROVISION":case"SCHEDULED_FOR_DELETION":return"danger";case"PRE_PROVISIONED":case"READY_FOR_DEPLOYMENT":default:return"pending"}},ae=a=>a.split("_").map(s=>`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()}`).join(" "),m=["IN_PROGRESS","DELETING","PROVISION_REQUEST","PROVISIONING","QUEUED","SCHEDULED_FOR_DELETION","DELETION_REQUEST","CREATED","DELETED"],D=(a,s,r)=>()=>{(async()=>await a()&&(s(),r()))()},S=(a,s,r)=>async()=>{r&&(a(r),s())},I=()=>{const{connectSession:a}=q(d),[s,r]=c.useState(1),[T,g]=c.useState({}),[O,P]=c.useState(null),{Modal:R,openModal:x,closeModal:u}=_(),{hasReadAccess:E}=J(),j=Q(T),[t,L,,C]=$({reapitConnectBrowserSession:d,action:H[z.paginatePipeline],headers:{Authorization:a==null?void 0:a.idToken},fetchWhenTrue:[a==null?void 0:a.idToken],queryParams:{...j,page:s}}),[,,b]=X({reapitConnectBrowserSession:d,action:W[Y.deletePipeline],method:"DELETE",uriParams:{appId:O},headers:{Authorization:a==null?void 0:a.idToken}}),{register:w,handleSubmit:y}=K({mode:"onChange"});return e.jsxs(f,{children:[e.jsx(N,{children:"IaaS Pipelines"}),e.jsx("form",{onChange:y(g),children:e.jsx(v,{className:p,children:e.jsx(U,{children:e.jsx(k,{id:"developer-search-box",...w("developerId"),getResults:n=>Z({company:n}).then(o=>(o==null?void 0:o.data)??[]),getResultLabel:n=>`${n.company} -  ${n.name}`,getResultValue:n=>n.id??"",placeholder:"Search developer organisations"})})})}),L?e.jsx(A,{}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:p,numberColumns:4,rows:t==null?void 0:t.items.map(({name:n,id:o,buildStatus:l,repository:i})=>({cells:[{label:"Name",value:n,icon:"apiInfographic",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Build Status",value:e.jsxs(e.Fragment,{children:[e.jsx(F,{intent:ee(l)}),ae(l)]}),narrowTable:{showLabel:!0}},{label:"Repository",value:i==null?void 0:i.repositoryUrl,narrowTable:{showLabel:!0}}],ctaContent:{headerContent:"Delete Pipeline",icon:m.includes(l)||E?void 0:"trashSystem",onClick:m.includes(l)||E?void 0:S(P,x,o)}}))}),e.jsxs(R,{title:"Delete Pipeline",children:[e.jsx(M,{hasGreyText:!0,children:"Are you sure you want to delete this pipeline? This will tear down any infrastructure you have provisioned and cannot be recovered."}),e.jsxs(V,{alignment:"right",children:[e.jsx(h,{onClick:u,children:"Close"}),e.jsx(h,{intent:"danger",onClick:D(b,u,C),children:"Delete"})]})]}),t&&e.jsx(B,{currentPage:t.meta.currentPage??1,numberPages:t.meta.totalPages??1,callback:r})]})]})};export{I as IaaS,I as default,D as handleDeletePipeline,S as handleOpenModal};
