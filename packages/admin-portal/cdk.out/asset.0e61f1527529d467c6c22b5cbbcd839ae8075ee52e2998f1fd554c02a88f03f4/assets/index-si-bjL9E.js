import{r as c,ag as _,j as e,W as f,am as N,aa as U,ab as h,ao as v,ax as A,a7 as k,aj as G,aJ as F,al as M,ae as V,af as p,an as Q}from"./vendor-ZH71Hs13.js";import{o as $,u as B,r as d,g as H,G as z,a as W,U as Y}from"./index-DYGYHHRm.js";import{u as q,a as J}from"./use-permissions-state-BndJTtcK.js";import{u as K}from"./index.esm-Ch-ie6LE.js";import{u as X}from"./use-reapit-update-Dbhu-yhb.js";import{f as Z}from"./developers-Czroeeo4.js";import"./constants-aos_c5Ih.js";const ee=a=>{switch(a){case"PROVISIONING":return"primary";case"SUCCEEDED":case"COMPLETED":return"success";case"IN_PROGRESS":case"QUEUED":return"neutral";case"FAILED":case"DELETING":case"DELETED":case"FAILED_TO_PROVISION":case"SCHEDULED_FOR_DELETION":return"danger";case"PRE_PROVISIONED":case"READY_FOR_DEPLOYMENT":default:return"pending"}},ae=a=>a.split("_").map(s=>`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()}`).join(" "),m=["IN_PROGRESS","DELETING","PROVISION_REQUEST","PROVISIONING","QUEUED","SCHEDULED_FOR_DELETION","DELETION_REQUEST","CREATED","DELETED"],D=(a,s,r)=>()=>{(async()=>await a()&&(s(),r()))()},S=(a,s,r)=>async()=>{r&&(a(r),s())},I=()=>{const{connectSession:a}=q(d),[s,r]=c.useState(1),[T,g]=c.useState({}),[x,O]=c.useState(null),{Modal:P,openModal:R,closeModal:u}=_(),{hasReadAccess:E}=J(),j=$(T),[t,C,,L]=B({reapitConnectBrowserSession:d,action:H[z.paginatePipeline],headers:{Authorization:a==null?void 0:a.idToken},fetchWhenTrue:[a==null?void 0:a.idToken],queryParams:{...j,page:s}}),[,,b]=X({reapitConnectBrowserSession:d,action:W[Y.deletePipeline],method:"DELETE",uriParams:{appId:x},headers:{Authorization:a==null?void 0:a.idToken}}),{register:w,handleSubmit:y}=K({mode:"onChange"});return e.jsxs(f,{children:[e.jsx(N,{children:"IaaS Pipelines"}),e.jsx("form",{onChange:y(g),children:e.jsx(U,{className:h,children:e.jsx(v,{children:e.jsx(A,{id:"developer-search-box",...w("developerId"),getResults:n=>Z({company:n}).then(o=>(o==null?void 0:o.data)??[]),getResultLabel:n=>`${n.company} -  ${n.name}`,getResultValue:n=>n.id??"",placeholder:"Search developer organisations"})})})}),C?e.jsx(k,{}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:h,numberColumns:4,rows:t==null?void 0:t.items.map(({name:n,id:o,buildStatus:l,repository:i})=>({cells:[{label:"Name",value:n,icon:"insights",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Build Status",value:e.jsxs(e.Fragment,{children:[e.jsx(F,{intent:ee(l)}),ae(l)]}),narrowTable:{showLabel:!0}},{label:"Repository",value:i==null?void 0:i.repositoryUrl,narrowTable:{showLabel:!0}}],ctaContent:{headerContent:"Delete Pipeline",icon:m.includes(l)||E?void 0:"trash",onClick:m.includes(l)||E?void 0:S(O,R,o)}}))}),e.jsxs(P,{title:"Delete Pipeline",children:[e.jsx(M,{hasGreyText:!0,children:"Are you sure you want to delete this pipeline? This will tear down any infrastructure you have provisioned and cannot be recovered."}),e.jsxs(V,{alignment:"right",children:[e.jsx(p,{onClick:u,children:"Close"}),e.jsx(p,{intent:"danger",onClick:D(b,u,L),children:"Delete"})]})]}),t&&e.jsx(Q,{currentPage:t.meta.currentPage??1,numberPages:t.meta.totalPages??1,callback:r})]})]})};export{I as IaaS,I as default,D as handleDeletePipeline,S as handleOpenModal};
