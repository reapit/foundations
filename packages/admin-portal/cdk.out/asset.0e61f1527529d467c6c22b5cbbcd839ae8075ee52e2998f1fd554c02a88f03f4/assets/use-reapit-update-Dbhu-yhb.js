import{n as K,o as N,r as O,aK as R,t as w}from"./vendor-ZH71Hs13.js";import{b as y,h as f,c as k,d as A,N as B,l as D}from"./index-DYGYHHRm.js";const H=({action:r,method:S="POST",returnType:d="none",headers:C={},uriParams:a,withCredentials:E,reapitConnectBrowserSession:p})=>{const{error:v,success:T}=K(),M=N(),{successMessage:h,errorMessage:m}=r,n=O.useMemo(y(r,void 0,a),[a,r]);console.log("url",n);const{mutateAsync:P,error:g,data:b,isSuccess:L,isLoading:x}=R([n,a],{mutationFn:async s=>{const{data:o,options:e}=s,u={...C,...(e==null?void 0:e.headers)??{}},t=e!=null&&e.uriParams?y(r,void 0,{...a,...e.uriParams})():n,l=await k(p,u);if(!l)throw new Error("Missing valid Reapit Connect Session, please try logging in again.");const i=await w(t,{method:S,headers:l,data:o,withCredentials:E});if(d==="response")return i.data;if(d==="location"&&i.headers){console.log("retunrType",d);const c=i.headers.location;if(!c)throw new Error("Location was not returned by server");const G=c.includes(".prod.paas")?c.replace(".prod.paas",""):c;return(await w(G,{method:"GET",headers:l})).data}return console.log("response",i,n),!0},onSuccess:()=>{h&&T(h,1e5)},onError:async s=>{const o=await p.connectSession(),e=s.message===A,u=s.code===B;if(e||u||!o)return M("/login");const t=f(s,m);v(t,5e3),D(new Error(t),o)}}),F=g?f(g,m):null;return[x,b,(s,o)=>P({data:s,options:o}).catch(e=>console.error("Caught error",e.message)),L,F]};export{H as u};
