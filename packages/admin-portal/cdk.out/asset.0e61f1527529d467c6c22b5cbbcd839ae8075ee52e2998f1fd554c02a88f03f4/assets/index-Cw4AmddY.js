import{j as e,aa as q,ac as E,ah as u,al as b,ao as j,ax as L,ad as g,ap as w,aq as N,aH as k,aI as P,aj as A,aA as G,aB as f,aD as H,aE as I,X as M,r as R,W,am as U,a7 as Y}from"./vendor-ZH71Hs13.js";import{u as $,d as V}from"./index.esm-Ch-ie6LE.js";import{f as z}from"./developers-Czroeeo4.js";import{u as v,r as y,g as T,G as C}from"./index-DYGYHHRm.js";import{S as X}from"./index-Co6JqKJd.js";import"./constants-aos_c5Ih.js";import"./FileSaver.min-BZwjJ9VL.js";const J=({setUsageFilters:s,apps:l,installations:t})=>{var x,c;const{register:r,handleSubmit:i,getValues:p}=$({mode:"all"}),{developerId:d,month:m,appId:o}=p();return e.jsx("form",{onChange:i(s),children:e.jsxs(q,{hasMargin:!0,children:[e.jsxs(E,{children:[e.jsx(u,{children:"Filters"}),e.jsx(b,{hasGreyText:!0,children:"Apply a filter to get started. Developer and month are required by default."})]}),e.jsx(j,{children:e.jsx(L,{label:"Company",id:"developer-search-box",...r("developerId"),getResults:a=>z({company:a,status:"confirmed"}).then(n=>(n==null?void 0:n.data)??[]),getResultLabel:a=>`${a.company} -  ${a.name}`,getResultValue:a=>a.id??"",placeholder:"Search developer organisations"})}),e.jsx(j,{children:e.jsx(g,{...r("month"),label:"Month",type:"month",defaultValue:V(new Date).subtract(1,"month").format("YYYY-MM")})}),e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(w,{children:"App"}),e.jsxs(N,{...r("appId"),disabled:!d||!m||!l,children:[e.jsx("option",{value:"",children:"Please Select"}),(x=l==null?void 0:l.data)==null?void 0:x.map(({id:a,name:n})=>e.jsx("option",{value:a,children:n},a))]})]})}),e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(w,{children:"Customer"}),e.jsxs(N,{...r("customerId"),disabled:!d||!m||!o||!t,children:[e.jsx("option",{value:"",children:"Please Select"}),(c=t==null?void 0:t.data)==null?void 0:c.map(({customerName:a,id:n,client:h})=>e.jsxs("option",{value:h,children:[a," (Code: ",h,")"]},n))]})]})})]})})},B="three-col-table",K=({billing:s})=>{var t,r,i,p;const l=((r=(t=s==null?void 0:s.services)==null?void 0:t.find(d=>d.name==="API Requests"))==null?void 0:r.items)??[];return l.length?e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsxs(P,{children:[e.jsx(u,{children:"Billable Amount"}),e.jsxs(b,{hasGreyText:!0,children:["\xA3",(i=s==null?void 0:s.totalCost)==null?void 0:i.toFixed(2).padStart(2,"0")]})]}),e.jsxs(P,{children:[e.jsx(u,{children:"Actual Cost"}),e.jsxs(b,{hasGreyText:!0,children:["\xA3",(p=s==null?void 0:s.actualCost)==null?void 0:p.toFixed(2).padStart(2,"0")]})]})]}),e.jsx(u,{children:"Breakdown"}),e.jsx(A,{rows:l.map(({name:d,amount:m,cost:o,itemCount:x,items:c})=>({cells:[{label:"Entity Name",value:d??"",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Total Number Calls",value:String(m)??"",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Total Cost",value:o?`\xA3${o.toFixed(2).padStart(2,"0")}`:"\xA30",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Total Number Endpoints",value:String(x)??"",icon:"property",cellHasDarkText:!0,narrowTable:{showLabel:!0}}],expandableContent:{content:e.jsx(e.Fragment,{children:e.jsxs(A,{children:[e.jsxs(G,{className:B,children:[e.jsx(f,{children:"Endpoint Name"}),e.jsx(f,{children:"Endpoint Number Calls"}),e.jsx(f,{children:"Endpoint Cost"})]}),c==null?void 0:c.map(({name:a,amount:n,cost:h})=>e.jsxs(H,{className:B,children:[e.jsx(I,{children:a}),e.jsx(I,{children:n}),e.jsx(I,{children:h?`\xA3${h}`:"\xA30"})]},a))]})})}}))})]}):e.jsx("div",{children:e.jsx(M,{isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No results found for your selected filters"})})},F=()=>{var h,S;const[s,l]=R.useState({}),{month:t,developerId:r,appId:i,customerId:p}=s,d=i?{applicationId:i}:{},m=p?{customerId:p}:{},[o,x]=v({reapitConnectBrowserSession:y,action:T[C.getBillingDataByMonth],queryParams:{developerId:r,type:"trafficEvents",...d,...m},uriParams:{month:t},headers:{"api-version":"2"},fetchWhenTrue:[t&&r]}),[c]=v({reapitConnectBrowserSession:y,action:T[C.getApps],queryParams:{developerId:r,pageSize:999},fetchWhenTrue:[t&&r]}),[a]=v({reapitConnectBrowserSession:y,action:T[C.getInstallations],queryParams:{appId:i,isInstalled:!0,pageSize:999},fetchWhenTrue:[t&&r&&i]}),n=((S=(h=o==null?void 0:o.services)==null?void 0:h.find(D=>D.name==="API Requests"))==null?void 0:S.items)??[];return e.jsxs(W,{children:[e.jsx(U,{children:"API Usage"}),e.jsx(J,{setUsageFilters:l,apps:c,installations:a}),e.jsx(X,{area:"BILLING",data:n}),x?e.jsx(Y,{}):e.jsx(K,{billing:o})]})};export{F as UsagePage,F as default};
