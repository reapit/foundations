import{j as e,aa as ie,ab as L,ao as E,ad as x,ap as oe,aq as ge,r as c,ag as Z,a7 as $,ai as M,ah as ee,al as z,aj as de,ae as P,af as i,ar as fe,X as O,an as ce,ac as k,as as we,at as Te,a5 as me,W as ye,am as Ce}from"./vendor-_Ftg20Hp.js";import{E as Se}from"./index-Dc-_fPKY.js";import{u as ue,t as R,a as De}from"./index.esm-DOuwMxsP.js";import{f as Me}from"./index-C-eCv2z-.js";import{u as ae,r as v,g as se,G as le,a as A,U as F,o as ke}from"./index-DivjyRvy.js";import{S as Ie}from"./index-CKZRxNYs.js";import{C as Ne}from"./create-subscriptions-D5FRCMNg.js";import{u as U}from"./use-reapit-update-D13rjc3a.js";import{a as pe,u as Le}from"./use-permissions-state-CJmar-BT.js";import{c as he,a as y,o as be}from"./yup-COG2kgBL.js";import{p as Ee,e as Pe,l as Re}from"./regexs-6gdYqTky.js";import"./FileSaver.min-CvPjENXQ.js";const Ae=({setDeveloperFilters:a})=>{const{register:s,handleSubmit:l}=ue({mode:"onChange"});return e.jsx("form",{onChange:l(Me(a,500)),children:e.jsxs(ie,{className:L,children:[e.jsx(E,{children:e.jsx(x,{...s("name"),label:"Developer Name",type:"search"})}),e.jsx(E,{children:e.jsx(x,{...s("company"),label:"Company Name",type:"search"})}),e.jsx(E,{children:e.jsx(x,{...s("gitHubUsername"),label:"Github Username",type:"search"})}),e.jsx(E,{children:e.jsx(x,{...s("registeredFrom"),label:"Registered From",type:"date"})}),e.jsx(E,{children:e.jsx(x,{...s("registeredTo"),label:"Registered To",type:"date"})}),e.jsx(E,{children:e.jsxs(x,{children:[e.jsx(oe,{children:"Status"}),e.jsxs(ge,{...s("status"),children:[e.jsx("option",{value:"",children:"Please Select"}),e.jsx("option",{value:"incomplete",children:"Incomplete"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"underReview",children:"Under Review"}),e.jsx("option",{value:"removed",children:"Removed"})]})]})})]})})},Fe=(a,s)=>()=>{s&&a(s)},Ue=(a,s)=>()=>{s&&a(s)},xe=(a,s)=>()=>{a(s)},Be=(a,s,l)=>()=>{(s||l)&&a()},Ge=(a,s,l)=>()=>{l&&(a(l),s())},We=(a,s,l)=>async()=>{await l()&&(s(),a(null))},qe=({devIdMembers:a})=>{var Y,_;const[s,l]=c.useState(null),[t,o]=c.useState(1),[m,r]=c.useState(null),[n,u]=c.useState(null),{hasReadAccess:p}=pe(),{Modal:g,openModal:j,closeModal:h}=Z(),[d,w,,B]=ae({reapitConnectBrowserSession:v,action:se[le.getDeveloperMembers],uriParams:{developerId:a,memberId:s==null?void 0:s.id},queryParams:{pageNumber:t,pageSize:12},fetchWhenTrue:[a]}),[f,I]=ae({reapitConnectBrowserSession:v,action:se[le.getUserInfo],queryParams:{email:encodeURIComponent(m??""),includeIdpData:!0},fetchWhenTrue:[m]}),[T,,re,G]=U({reapitConnectBrowserSession:v,action:A[F.updateMember],method:"PUT",uriParams:{developerId:a,memberId:s==null?void 0:s.id}}),[,,V,X]=U({reapitConnectBrowserSession:v,action:A[F.deleteMember],method:"DELETE",uriParams:{developerId:n==null?void 0:n.developerId,memberId:n==null?void 0:n.id}});c.useEffect(Be(B,G,X),[G,X]),c.useEffect(Fe(re,s),[s]);const C=((Y=f==null?void 0:f.idpData)==null?void 0:Y.authEvents)??[];return w?e.jsx($,{}):(_=d==null?void 0:d.data)!=null&&_.length?e.jsxs("div",{className:M,children:[e.jsx(ee,{children:"Total Members"}),e.jsx(z,{hasGreyText:!0,children:d.totalCount}),e.jsx(de,{className:L,rows:d.data.map(S=>{var Q,H;const{name:W,jobTitle:te,status:q,role:b,gitHubUsername:ne,agreedTerms:N,created:K,email:D}=S;return{cells:[{label:"Developer Name",value:W,cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Member Email",value:D,narrowTable:{showLabel:!0}},{label:"Job Title",value:te,narrowTable:{showLabel:!0}},{label:"Role",value:b,narrowTable:{showLabel:!0}},{label:"Github Username",value:ne,narrowTable:{showLabel:!0}},{label:"Member Status",value:q,narrowTable:{showLabel:!0}},{label:"Agreed Terms Date",value:N?R(N):"-",narrowTable:{showLabel:!0}},{label:"Created Date",value:K?R(K):"-",narrowTable:{showLabel:!0}}],expandableContent:{content:e.jsxs(e.Fragment,{children:[e.jsxs(P,{alignment:"center",children:[e.jsxs(i,{intent:"primary",disabled:p||T,loading:T,onClick:xe(l,{...S,role:b==="admin"?"user":"admin"}),children:["Set As ",b==="admin"?"User":"Admin"]}),e.jsx(i,{intent:"primary",disabled:I,loading:I,onClick:Ue(r,D),children:"Get Login Info"}),e.jsx(i,{type:"button",intent:"danger",disabled:p,onClick:Ge(u,j,S),children:"Delete Member"}),e.jsx(i,{intent:"danger",disabled:p||T,loading:T,onClick:xe(l,{...S,status:q==="active"?"inactive":"active"}),children:q==="active"?"Disable":"Enable"})]}),I&&e.jsx($,{className:M}),f&&m===D&&C.length?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:M,children:"Recent Logins"}),(H=(Q=f.idpData)==null?void 0:Q.authEvents)==null?void 0:H.map((J,ve)=>ve<5?e.jsx(fe,{hasGreyText:!0,children:J},J):null)]}):f&&m===D?e.jsx(O,{className:M,isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No login information for user"}):null]})}}})}),e.jsx(ce,{callback:o,currentPage:t,numberPages:Math.ceil(((d==null?void 0:d.totalCount)??1)/12)}),e.jsxs(g,{title:"Delete Member",children:[e.jsx(z,{hasGreyText:!0,children:"Are you sure you want to delete this member? This action cannot be undone."}),e.jsxs(P,{alignment:"right",children:[e.jsx(i,{onClick:h,children:"Cancel"}),e.jsx(i,{intent:"danger",onClick:We(u,h,V),children:"Delete"})]})]})]}):e.jsx(O,{className:M,isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No results found for your selected filters"})},He=he().shape({status:y().trim().required(),reapitReference:y().trim().when("status",{is:a=>a=="confirmed",then:y().required().max(50,"Maximum of 50 characters allowed")}),notes:y().trim().max(200,"Maximum of 200 characters allowed")}),Je=(a,s)=>l=>{s&&a({...s,companyName:s.company,...l})},ze=(a,s,l,t)=>()=>{t&&(a(),s(null),l())},Oe=({developer:a,closeModal:s,setDeveloperUpdate:l,refreshDevelopers:t})=>{var j,h;const{register:o,handleSubmit:m,control:r,formState:{errors:n}}=ue({resolver:be(He),defaultValues:{status:a==null?void 0:a.status,reapitReference:a==null?void 0:a.reapitReference,notes:a==null?void 0:a.notes}}),[,,u,p]=U({reapitConnectBrowserSession:v,action:A[F.updateDeveloper],method:"PUT",uriParams:{developerId:a==null?void 0:a.id}});c.useEffect(ze(t,l,s,p),[p]);const g=De({control:r,name:"status"});return a?e.jsxs("form",{onSubmit:m(Je(u,a)),children:[e.jsxs(ie,{className:L,children:[e.jsxs(k,{children:[e.jsx(oe,{children:"Update Developer Status"}),e.jsx(we,{...o("status"),hasGreyBg:!0,options:[{id:"option-status-incomplete",value:"incomplete",text:"Incomplete",isChecked:a.status==="incomplete"},{id:"option-status-pending",value:"pending",text:"Pending",isChecked:a.status==="pending"},{id:"option-status-confirmed",value:"confirmed",text:"Confirmed",isChecked:a.status==="confirmed"},{id:"option-status-underReview",value:"underReview",text:"Under Review",isChecked:a.status==="underReview"},{id:"option-status-removed",value:"removed",text:"Removed",isChecked:a.status==="removed"}]})]}),e.jsx(k,{children:e.jsx(x,{...o("reapitReference"),label:"Reapit Reference",placeholder:"Reapit Reference if account confirmed",errorMessage:(j=n==null?void 0:n.reapitReference)==null?void 0:j.message,icon:(h=n==null?void 0:n.reapitReference)!=null&&h.message?"asterisk":null,intent:"danger",disabled:g!=="confirmed"})}),e.jsx(k,{children:e.jsxs(x,{children:[e.jsx(Te,{type:"text",...o("notes"),placeholder:"Notes on developer"}),e.jsx(oe,{children:"Notes"})]})})]}),e.jsxs(P,{alignment:"right",children:[e.jsx(i,{onClick:s,children:"Cancel"}),e.jsx(i,{intent:"primary",type:"submit",children:"Confirm"})]})]}):null},Ve=({devIdApps:a})=>{var m;const[s,l]=c.useState(1),[t,o]=ae({reapitConnectBrowserSession:v,action:se[le.getApps],queryParams:{pageNumber:s,pageSize:12,developerId:a},fetchWhenTrue:[a]});return o?e.jsx($,{}):(m=t==null?void 0:t.data)!=null&&m.length?e.jsxs("div",{className:M,children:[e.jsx(ee,{children:"Total Apps"}),e.jsx(z,{hasGreyText:!0,children:t.totalCount}),e.jsx(de,{className:L,rows:t.data.map(({name:r,id:n,summary:u,isListed:p,isDirectApi:g,isFeatured:j,created:h,publicListedDate:d})=>({cells:[{label:"App Name",value:r??"",cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"AppId",value:n??"",narrowTable:{showLabel:!0}},{label:"Summary",value:u??"",narrowTable:{showLabel:!0}},{label:"Listed",value:e.jsx(me,{icon:p?"check":"close"}),narrowTable:{showLabel:!0}},{label:"Integration",value:e.jsx(me,{icon:g?"check":"close"}),narrowTable:{showLabel:!0}},{label:"Featured",value:e.jsx(me,{icon:j?"check":"close"}),narrowTable:{showLabel:!0}},{label:"Created",value:R(h)??"",narrowTable:{showLabel:!0}},{label:"Publicly Listed",value:d?R(d):"-",narrowTable:{showLabel:!0}}],expandableContent:{content:e.jsx(O,{isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"Visit the dedicated apps page to perform actions on this app"})}}))}),e.jsx(ce,{callback:l,currentPage:s,numberPages:Math.ceil(((t==null?void 0:t.totalCount)??1)/12)})]}):e.jsx("div",{className:M,children:e.jsx(O,{isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No results found for your selected filters"})})},Xe=he().shape({name:y().trim().required().matches(Ee,"Full name is not valid").max(256,"Maximum character length of 256"),email:y().trim().required().matches(Pe,"Email address is not valid").max(256,"Maximum character length of 256"),jobTitle:y().trim().required().matches(Re,"Job title is not valid").max(256,"Maximum character length of 256"),message:y().trim()}),Ye=(a,s)=>async l=>{await a(l)&&s()},_e=({developerId:a,closeModal:s})=>{var n,u,p,g,j,h,d,w;const{connectSession:l}=Le(v),[,,t]=U({reapitConnectBrowserSession:v,action:A[F.inviteMember],method:"POST",uriParams:{developerId:a}}),{register:o,handleSubmit:m,formState:{errors:r}}=ue({resolver:be(Xe),defaultValues:{name:"",email:"",jobTitle:"",message:"",sender:l==null?void 0:l.loginIdentity.email}});return e.jsxs("form",{onSubmit:m(Ye(t,s)),children:[e.jsxs(ie,{hasMargin:!0,children:[e.jsx(k,{children:e.jsx(x,{...o("name"),label:"Name",placeholder:"Your colleague's full name",errorMessage:(n=r==null?void 0:r.name)==null?void 0:n.message,icon:(u=r==null?void 0:r.name)!=null&&u.message?"asterisk":null,intent:"danger"})}),e.jsx(k,{children:e.jsx(x,{...o("email"),type:"email",label:"Email",placeholder:"An email address we can contact your colleague at",errorMessage:(p=r==null?void 0:r.email)==null?void 0:p.message,icon:(g=r==null?void 0:r.email)!=null&&g.message?"asterisk":null,intent:"danger"})}),e.jsx(k,{children:e.jsx(x,{...o("jobTitle"),label:"Job Title",placeholder:"Your colleague's role at your company'",errorMessage:(j=r==null?void 0:r.jobTitle)==null?void 0:j.message,icon:(h=r==null?void 0:r.jobTitle)!=null&&h.message?"asterisk":null,intent:"danger"})}),e.jsx(k,{children:e.jsx(x,{...o("message"),label:"Invite Message",placeholder:"An optional invite message",errorMessage:(d=r==null?void 0:r.message)==null?void 0:d.message,icon:(w=r==null?void 0:r.message)!=null&&w.message?"asterisk":null,intent:"danger"})})]}),e.jsxs(P,{alignment:"right",children:[e.jsx(i,{onClick:s,children:"Close"}),e.jsx(i,{intent:"primary",type:"submit",children:"Send Invite"})]})]})},Ke=(a,s,l)=>()=>{l&&(s(l),a())},Qe=(a,s,l,t)=>()=>{t&&(a(t),s(null),l(null))},Ze=(a,s,l,t)=>()=>{t&&(a(t),s(null),l(null))},$e=(a,s,l,t)=>()=>{t&&(a(t),s(null),l(null))},ea=(a,s,l)=>()=>{l&&(a(l),s())},aa=(a,s,l,t)=>async()=>{await l()&&(s(),a(null),t())},sa=(a,s,l,t)=>async()=>{const o=t?0:300;await s({...a,companyName:a.company,developerEditionSubscriptionCost:o},{uriParams:{developerId:a==null?void 0:a.id}})&&l()},la=(a,s,l,t)=>()=>{t&&(s(null),a(t),l())},ra=({developers:a,refreshDevelopers:s})=>{var S;const{Modal:l,openModal:t,closeModal:o}=Z(),{Modal:m,openModal:r,closeModal:n}=Z(),{Modal:u,openModal:p,closeModal:g}=Z(),[j,h]=c.useState(null),[d,w]=c.useState(null),[B,f]=c.useState(null),[I,T]=c.useState(null),[re,G]=c.useState(null),[V,X]=c.useState(null),{hasReadAccess:C}=pe(),[,,Y]=U({reapitConnectBrowserSession:v,action:A[F.updateDeveloper],method:"PUT"}),[,,_]=U({reapitConnectBrowserSession:v,action:A[F.deleteDeveloper],method:"DELETE",uriParams:{developerId:re}});return(S=a==null?void 0:a.data)!=null&&S.length?e.jsxs("div",{className:L,children:[e.jsx(ee,{children:"Total Developers"}),e.jsx(z,{hasGreyText:!0,children:a.totalCount}),e.jsx(de,{rows:a.data.map(W=>{const{company:te,name:q,id:b,jobTitle:ne,status:N,email:K,agreedTerms:D,created:Q,developerEditionSubscriptionCost:H}=W,J=!!(H===null||Math.round(H??0));return{cells:[{label:"Company Name",value:te,cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Developer Name",value:q,cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Developer Email",value:K,cellHasDarkText:!0,narrowTable:{showLabel:!0}},{label:"Job Title",value:ne,narrowTable:{showLabel:!0}},{label:"Account Status",value:N,narrowTable:{showLabel:!0}},{label:"Created Date",value:R(Q),narrowTable:{showLabel:!0}},{label:"Agreed Terms Date",value:D?R(D):"-",narrowTable:{showLabel:!0}}],expandableContent:{content:e.jsxs(e.Fragment,{children:[e.jsxs(P,{alignment:"center",children:[e.jsx(i,{type:"button",intent:"primary",disabled:C,onClick:Ke(t,h,W),children:"Update Status"}),e.jsx(i,{type:"button",intent:"primary",disabled:C,onClick:sa(W,Y,s,J),children:J?"Pays For DevEdition":"DevEdition is Free"}),e.jsxs(i,{onClick:$e(T,f,w,b),intent:"primary",disabled:C||N!=="confirmed",children:["Toggle Subscription ",N!=="confirmed"?"(Status Not Confirmed)":""]}),e.jsx(i,{onClick:la(X,w,p,b),intent:"primary",disabled:C,children:"Invite Member"}),e.jsx(i,{intent:"primary",onClick:Qe(w,T,f,b),children:"Fetch Members"}),e.jsx(i,{intent:"primary",onClick:Ze(f,T,w,b),children:"Fetch Apps"}),e.jsx(i,{type:"button",intent:"danger",disabled:C,onClick:ea(G,r,b),children:"Delete Developer"})]}),d&&d===b&&e.jsx(qe,{devIdMembers:d}),B&&B===b&&e.jsx(Ve,{devIdApps:B}),I&&I===b&&e.jsx(Ne,{developerId:b,subscriptionType:"developerRegistration"})]})}}})}),e.jsx(l,{title:"Update Developer Status",children:e.jsx(Oe,{developer:j,closeModal:o,setDeveloperUpdate:h,refreshDevelopers:s})}),e.jsxs(m,{title:"Delete Developer",children:[e.jsx(z,{hasGreyText:!0,children:"Are you sure you want to delete this developer? This action cannot be undone."}),e.jsxs(P,{alignment:"right",children:[e.jsx(i,{onClick:n,children:"Cancel"}),e.jsx(i,{intent:"danger",onClick:aa(G,n,_,s),children:"Delete"})]})]}),e.jsx(u,{title:"Invite Developer Org Member",children:V&&e.jsx(_e,{developerId:V,closeModal:g})})]}):e.jsx("div",{className:L,children:e.jsx(O,{isExpanded:!0,isFullWidth:!0,isInline:!0,intent:"primary",children:"No results found for your selected filters"})})},ta=a=>()=>{a(!1)},je=()=>{const[a,s]=c.useState({}),[l,t]=c.useState(1),[o,m]=c.useState(12),[r,n,,u]=ae({reapitConnectBrowserSession:v,action:se[le.getDevelopers],queryParams:{pageNumber:l,pageSize:o,...ke(a)}});return e.jsx(Se,{children:e.jsxs(ye,{children:[e.jsx(Ce,{children:"Developers"}),e.jsx(Ae,{setDeveloperFilters:s}),n?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{area:"DEVELOPERS",data:r,setPageSize:m}),e.jsx(ra,{developers:r,refreshDevelopers:u}),e.jsx(ce,{callback:t,currentPage:l,numberPages:Math.ceil(((r==null?void 0:r.totalCount)??1)/12)})]})]})})};export{je as DevsManagement,ta as closeDisableMemberModal,je as default};
