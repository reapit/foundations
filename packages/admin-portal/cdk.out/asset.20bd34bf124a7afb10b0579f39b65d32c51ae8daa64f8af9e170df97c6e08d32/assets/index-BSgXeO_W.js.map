{"version":3,"file":"index-BSgXeO_W.js","sources":["../../src/components/billing/index.tsx"],"sourcesContent":["import React, { useEffect, useState, Dispatch, SetStateAction, FC } from 'react'\nimport {\n  Button,\n  elMb11,\n  FormLayout,\n  InputGroup,\n  InputWrap,\n  PersistentNotification,\n  Table,\n  TableCell,\n  TableHeader,\n  TableHeadersRow,\n  TableRow,\n  TableRowContainer,\n} from '@reapit/elements'\nimport { fetchDeveloperBillingPeriod } from '../../services/developers'\nimport dayjs from 'dayjs'\nimport FileSaver from 'file-saver'\nimport { PageContainer, Title } from '@reapit/elements'\nimport { FetchError } from '@reapit/utils-common'\nimport { useForm } from 'react-hook-form'\n\nexport interface SelectOption {\n  label?: string\n  value?: string\n}\n\nexport interface BillingFilters {\n  month?: string\n}\n\nexport const handleSaveFile = (billingFile: Blob, filename: string) => () => {\n  FileSaver.saveAs(billingFile, filename)\n}\n\nexport const handleDownloadBillingPeriod =\n  (setBillingFile: Dispatch<SetStateAction<Blob | null>>, period?: string) => () => {\n    const fetchBilling = async () => {\n      if (!period) return\n\n      try {\n        const billingFile = await fetchDeveloperBillingPeriod({ period })\n\n        if (!billingFile || billingFile instanceof FetchError) {\n          throw billingFile\n        }\n        setBillingFile(billingFile)\n      } catch (error) {\n        console.error(error)\n      }\n    }\n\n    fetchBilling()\n  }\n\nexport const AdminBilling: FC = () => {\n  const [billingFilters, setBillingFilters] = useState<BillingFilters>()\n  const [billingFile, setBillingFile] = useState<Blob | null>(null)\n\n  const { register, handleSubmit } = useForm<BillingFilters>({\n    mode: 'onChange',\n  })\n\n  useEffect(handleDownloadBillingPeriod(setBillingFile, billingFilters?.month), [billingFilters])\n\n  return (\n    <PageContainer>\n      <Title>Billing</Title>\n      <form onChange={handleSubmit(setBillingFilters)}>\n        <FormLayout className={elMb11}>\n          <InputWrap>\n            <InputGroup {...register('month')} label=\"Month\" type=\"month\" />\n          </InputWrap>\n        </FormLayout>\n      </form>\n      {billingFile && billingFilters?.month ? (\n        <Table className={elMb11}>\n          <TableHeadersRow>\n            <TableHeader>Period</TableHeader>\n            <TableHeader>Download Billing</TableHeader>\n          </TableHeadersRow>\n          <TableRowContainer>\n            <TableRow>\n              <TableCell>{dayjs(billingFilters.month).format('MMMM YYYY')}</TableCell>\n              <TableCell>\n                <Button onClick={handleSaveFile(billingFile, `billing-developer-period-${billingFilters.month}.csv`)}>\n                  Download\n                </Button>\n              </TableCell>\n            </TableRow>\n          </TableRowContainer>\n        </Table>\n      ) : (\n        <PersistentNotification intent=\"primary\" isExpanded={true} isInline isFullWidth>\n          No billing file available for download.\n        </PersistentNotification>\n      )}\n    </PageContainer>\n  )\n}\n\nexport default AdminBilling\n"],"names":["handleSaveFile","billingFile","filename","FileSaver","handleDownloadBillingPeriod","setBillingFile","period","fetchDeveloperBillingPeriod","FetchError","error","AdminBilling","billingFilters","setBillingFilters","useState","register","handleSubmit","useForm","useEffect","PageContainer","jsx","Title","FormLayout","elMb11","InputWrap","InputGroup","jsxs","Table","TableHeadersRow","TableHeader","TableRowContainer","TableRow","TableCell","dayjs","Button","PersistentNotification"],"mappings":"sXA+BO,MAAMA,EAAiB,CAACC,EAAmBC,IAAqB,IAAM,CACjEC,EAAA,OAAOF,EAAaC,CAAQ,CACxC,EAEaE,EACX,CAACC,EAAuDC,IAAoB,IAAM,EAC3D,SAAY,CAC/B,GAAKA,EAED,GAAA,CACF,MAAML,EAAc,MAAMM,EAA4B,CAAE,OAAAD,CAAQ,CAAA,EAE5D,GAAA,CAACL,GAAeA,aAAuBO,EACnC,MAAAP,EAERI,EAAeJ,CAAW,QACnBQ,EAAO,CACd,QAAQ,MAAMA,CAAK,CACrB,CAAA,IAIJ,EAEWC,EAAmB,IAAM,CACpC,KAAM,CAACC,EAAgBC,CAAiB,EAAIC,EAAyB,SAAA,EAC/D,CAACZ,EAAaI,CAAc,EAAIQ,WAAsB,IAAI,EAE1D,CAAE,SAAAC,EAAU,aAAAC,CAAa,EAAIC,EAAwB,CACzD,KAAM,UAAA,CACP,EAEDC,OAAAA,EAAA,UAAUb,EAA4BC,EAAgBM,GAAgB,KAAK,EAAG,CAACA,CAAc,CAAC,SAG3FO,EACC,CAAA,SAAA,CAAAC,EAAAA,IAACC,GAAM,SAAO,SAAA,CAAA,EACdD,EAAAA,IAAC,OAAK,CAAA,SAAUJ,EAAaH,CAAiB,EAC5C,SAACO,EAAA,IAAAE,EAAA,CAAW,UAAWC,EACrB,SAACH,EAAAA,IAAAI,EAAA,CACC,eAACC,EAAY,CAAA,GAAGV,EAAS,OAAO,EAAG,MAAM,QAAQ,KAAK,OAAA,CAAQ,CAChE,CAAA,CAAA,CACF,CACF,CAAA,EACCb,GAAeU,GAAgB,MAC7Bc,EAAA,KAAAC,EAAA,CAAM,UAAWJ,EAChB,SAAA,CAAAG,OAACE,EACC,CAAA,SAAA,CAAAR,EAAAA,IAACS,GAAY,SAAM,QAAA,CAAA,EACnBT,EAAAA,IAACS,GAAY,SAAgB,kBAAA,CAAA,CAAA,EAC/B,EACAT,EAAA,IAACU,EACC,CAAA,SAAAJ,EAAAA,KAACK,EACC,CAAA,SAAA,CAAAX,MAACY,GAAW,SAAMC,EAAArB,EAAe,KAAK,EAAE,OAAO,WAAW,EAAE,EAC3DQ,EAAA,IAAAY,EAAA,CACC,SAACZ,EAAA,IAAAc,EAAA,CAAO,QAASjC,EAAeC,EAAa,4BAA4BU,EAAe,KAAK,MAAM,EAAG,mBAEtG,CAAA,EACF,CAAA,CAAA,CACF,CACF,CAAA,CAAA,CACF,CAAA,EAECQ,EAAAA,IAAAe,EAAA,CAAuB,OAAO,UAAU,WAAY,GAAM,SAAQ,GAAC,YAAW,GAAC,SAEhF,yCAAA,CAAA,CAEJ,CAAA,CAAA,CAEJ"}