/* eslint-disable */
module.exports = {
name: "@ojkelly/plugin-build",
factory: function (require) {
var plugin;plugin=(()=>{var e={998:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>z});const r=require("@yarnpkg/cli"),o=require("@yarnpkg/core"),i=require("@yarnpkg/libzip"),s=require("@yarnpkg/fslib"),a=require("clipanion"),u=require("path");var c=n.n(u),l=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};class d extends r.BaseCommand{constructor(){super(...arguments),this.json=!1,this.archiveName="bundle.zip",this.exclude=[]}async removeUnusedPackages(e,t,n){const{project:i,workspace:a}=await o.Project.find(n,t);if(!a)throw new r.WorkspaceRequiredError(i.cwd,t);const u=new Set([a]);for(const e of u)for(const t of o.Manifest.hardDependencies)for(const n of e.manifest.getForScope(t).values()){const e=i.tryWorkspaceByDescriptor(n);null!==e&&u.add(e)}for(const t of i.workspaces)u.has(t)||t.cwd!==e&&await s.xfs.removePromise(t.cwd)}async removeExcluded(e,t){const n=e+"/.git";try{await s.xfs.lstatPromise(n)&&await s.xfs.removePromise(n)}catch(e){}await t.map(async t=>{t.startsWith(e)&&await s.xfs.lstatPromise(t)&&await s.xfs.removePromise(t)})}async execute(){return await s.xfs.mktempPromise(async e=>{var t,n,a,u;const l=""+this.context.cwd,d=s.ppath.join(l,this.archiveName),p=await o.Configuration.find(this.context.cwd,this.context.plugins);if(null===p.projectCwd)throw new Error("Can't find project directory");const f=l.replace(p.projectCwd,""),g=new s.NodeFS;await s.xfs.copyPromise(e,p.projectCwd,{baseFs:g});const m=`${e}${f}`,v=this.exclude,b=`${m}/${this.archiveName}`;try{await s.xfs.lstatPromise(b)&&v.push(b)}catch(e){}await this.removeExcluded(e,v);const y=await o.Configuration.find(m,this.context.plugins),w=await o.Cache.find(y);await this.removeUnusedPackages(e,m,y);const{project:C,workspace:R}=await o.Project.find(y,m);if(!R)throw new r.WorkspaceRequiredError(C.cwd,m);const _=new Set([R]);for(const e of _)for(const t of o.Manifest.hardDependencies)for(const n of e.manifest.getForScope(t).values()){const e=C.tryWorkspaceByDescriptor(n);null!==e&&_.add(e)}for(const e of C.workspaces)e.manifest.devDependencies.clear(),_.has(e)||(e.manifest.dependencies.clear(),e.manifest.peerDependencies.clear());if(null===(n=null===(t=null==R?void 0:R.manifest)||void 0===t?void 0:t.raw)||void 0===n?void 0:n.main){const t=R.relativeCwd+c().sep+(null===(u=null===(a=null==R?void 0:R.manifest)||void 0===a?void 0:a.raw)||void 0===u?void 0:u.main),n="./.pnp.js";s.xfs.writeFilePromise(`${e}${c().sep}entrypoint.js`,h(t,n))}return(await o.StreamReport.start({configuration:y,json:this.json,stdout:this.context.stdout,includeLogs:!0},async t=>{await C.install({cache:w,report:t}),t.reportInfo(null,"Getting libzip");const n=await(0,i.getLibzipPromise)();t.reportInfo(null,"Creating archive");const r=new s.ZipFS(d,{create:!0,libzip:n});t.reportInfo(null,"Copying files to archive"),await r.copyPromise("bundle",e,{baseFs:g}),r.saveAndClose(),t.reportJson({name:"ArchiveSuccess",message:"Archive created successfuly at ",outputArchive:d})})).exitCode()})}}d.usage=a.Command.Usage({category:"Build commands",description:"bundle a workspace package into a deployable archive",details:"\n      This command will bundle up the source of the target package along with\n      its dependencies into an archive.\n\n      This is designed to be used for deployment, not for publishing, so\n      everything to run except for a runtime (ie node) is bundled into\n      the archive.\n\n      Call this after you have run your build step (if any).\n\n      This is designed to work best with zero-install configurations. If you\n      don't have that, run `yarn install` before this command.\n\n      Why not just compile like we do on the front-end?\n      Some dependencies may use require in interesting ways, or be or call\n      binaries. It's safest not to transpile them.\n\n      If the `--json` flag is set the output will follow a JSON-stream output\n      also known as NDJSON (https://github.com/ndjson/ndjson-spec).\n\n      `-o,--output-directory` sets the output directory.\n\n      `-a,--archive-name` sets the name of the archive. Any files matching\n      this, will be excluded from subsequent archives. Defaults to ./bundle.tgz\n    "}),l([a.Command.Boolean("--json")],d.prototype,"json",void 0),l([a.Command.String("-o,--output-directory")],d.prototype,"outputDirectory",void 0),l([a.Command.String("-a,--archive-name")],d.prototype,"archiveName",void 0),l([a.Command.Array("--exclude")],d.prototype,"exclude",void 0),l([a.Command.Path("bundle")],d.prototype,"execute",null);const h=(e,t)=>`\n"use strict";\n\nconst pnp = require("${t}").setup();\n\nconst index = require("./${e}");\n\nObject.defineProperty(exports, "__esModule", { value: true });\n\nexports.default = index;\n`,p=require("@yarnpkg/parsers");async function f(e){return await async function(e){var t,n,r,o,i,a,u,c,l;let d={};const h=s.ppath.join(e.projectCwd||e.startingCwd,".yarnbuildrc.yml");if(s.xfs.existsSync(h)){const e=await s.xfs.readFilePromise(h,"utf8");try{d=(0,p.parseSyml)(e)}catch(t){let n="";throw e.match(/^\s+(?!-)[^:]+\s+\S+/m)&&(n=" (in particular, make sure you list the colons after each key name)"),new Error(`Parse error when loading ${h}; please check it's proper Yaml${n}`)}}return{commands:{build:"string"==typeof(null===(t=null==d?void 0:d.commands)||void 0===t?void 0:t.build)?d.commands.build:"build",test:"string"==typeof(null===(n=null==d?void 0:d.commands)||void 0===n?void 0:n.test)?d.commands.test:"test",dev:"string"==typeof(null===(r=null==d?void 0:d.commands)||void 0===r?void 0:r.dev)?d.commands.dev:"dev"},folders:{input:"string"==typeof(null===(o=null==d?void 0:d.folders)||void 0===o?void 0:o.input)?d.folders.input:".",output:"string"==typeof(null===(i=null==d?void 0:d.folders)||void 0===i?void 0:i.output)?d.folders.output:"build"},enableBetaFeatures:{folderConfiguration:"string"!=typeof(null===(a=null==d?void 0:d.enableBetaFeatures)||void 0===a?void 0:a.folderConfiguration)||"false"!==(null===(u=null==d?void 0:d.enableBetaFeatures)||void 0===u?void 0:u.folderConfiguration),targetedBuilds:"string"==typeof(null===(c=null==d?void 0:d.enableBetaFeatures)||void 0===c?void 0:c.targetedBuilds)&&"true"===(null===(l=null==d?void 0:d.enableBetaFeatures)||void 0===l?void 0:l.targetedBuilds)}}}(e)}var g=n(820),m=n.n(g);const v=require("os"),b=require("events");var y=n(103),w=n(299),C=n.n(w),R=n(344),_=n(106),k=n.n(_),I=n(285),$=n.n(I);class E{constructor(){this.nodes={},this.size=0,this.runSize=0,this.ran=new Set}addNode(e){if(this.nodes[e])return this.nodes[e];const t=new P(e,this);return this.nodes[e]=t,this.size++,t}getNode(e){if(this.nodes[e])return this.nodes[e]}resetRuns(){this.ran=new Set}async resolve(e){const t=new Set,n=new Set;await this.resolveNode(e,t,n)}async resolveNode(e,t,n){n.add(e.id);for(const r of e.dependencies)if(!t.has(r.id)){if(n.has(r.id))throw new x(`${e.id} has a cyclic dependency on ${r.id}`);await this.resolveNode(r,t,n)}t.add(e.id),n.delete(e.id)}async run(e){const t=new Set,n=new Set,r={};for(const n of e)this.resolveQueue(n,t,r);return await new Promise(e=>{this.workLoop(t,r,n,e)}),r}workLoop(e,t,n,r){0!==e.size&&e.forEach(r=>{var o,i;r.canStart(t)&&((null===(o=null==r?void 0:r.node)||void 0===o?void 0:o.runCallback)?(null===(i=null==r?void 0:r.node)||void 0===i||i.runCallback(t),n.add(r.node)):t[r.node.id]={success:!0,done:!0},e.delete(r))}),n.forEach((e,r)=>{t[e.id].done&&n.delete(r)}),Object.keys(t).map(e=>{var n,r;return null===(r=null===(n=t[e])||void 0===n?void 0:n.done)||void 0===r||r}).every(e=>!0===e)?r():setTimeout(()=>this.workLoop(e,t,n,r),30)}resolveQueue(e,t,n){const r=[];for(const o of e.dependencies)if(r.push(o.id),!n[o.id]&&o.runCallback){n[o.id]=Object.assign({},E.RunLogInit);const e=this.resolveQueue(o,t,n),r={node:o,canStart:E.QueueItemCanStart(e)};t.add(r)}if(!n[e.id]&&e.runCallback){n[e.id]=Object.assign({},E.RunLogInit);const o={node:e,canStart:E.QueueItemCanStart(r)};t.add(o)}return r}}E.RunLogInit={success:!1,done:!1},E.QueueItemCanStart=e=>t=>e.map(e=>{var n,r;return null===(r=null===(n=t[e])||void 0===n?void 0:n.done)||void 0===r||r}).every(e=>!0===e);class P{constructor(e,t){this.id=e,this.dependencies=[],this.graph=t}addDependency(e){return this.dependencies.push(e),this}addWorkSpace(e){return this.workspace=e,this}addRunCallback(e){return this.runCallback||(this.runCallback=t=>e().then(e=>{t[this.id]={done:!0,success:e}}),this.graph.runSize++),this}}class x extends Error{constructor(e){super(e),this.name="CyclicDependencyError",this.code="YN0003"}}const S="[";class j{static pad(e=1){for(let t=0;t<e;t++)process.stdout.write("\n");j.cursorUp(e)}static cursorUp(e=1){process.stdout.write(S+(e+"A"))}static cursorSave(){process.stdout.write("[s")}static cursorRestore(){process.stdout.write("[u")}static autoWrap(e){e?process.stdout.write("[?7h"):process.stdout.write("[?7l")}static clearScreenDown(){process.stdout.write("[J")}static async cursorPositionReport(){return new Promise(e=>{process.stdin.setRawMode(!0),process.stdin.once("data",t=>{process.stdin.setRawMode(!1),process.stdin.pause();const[n,r]=t.slice(2,t.length-1).toString().split(";").map(Number);e({x:r,y:n})}),process.stdout.write("[6n")})}static setScrollableRegion(e,t){process.stdout.write(`[${e};${t}r`)}static resetScrollableRegion(){process.stdout.write("[r")}static moveTo(e){process.stdout.write(`[${e.y};${e.x}H`)}static cursorHome(){process.stdout.write("[H")}static alternateScreen(){process.stdout.write("[?1049h")}static mainScreen(){process.stdout.write("[?1049l")}static linesRequired(e,t){var n;const r=new RegExp(`([^\n]{0,${t}})(\n)?`,"gm");return(null!==(n=k()(e).match(r))&&void 0!==n?n:[""]).length-1}}j.row=0,j.column=0;var T,O;!function(e){e.pending="pending",e.inProgress="inProgress",e.failed="failed",e.succeeded="succeeded"}(T||(T={})),function(e){e.pending="pending",e.start="start",e.info="info",e.error="error",e.success="success",e.fail="fail",e.finish="finish"}(O||(O={}));const B=async(e,t)=>{let n=0;const r=await s.xfs.readdirPromise(e);return await Promise.all(r.map(async r=>{const o=`${e}${c().sep}${r}`;if(t&&o.startsWith(t))return;const i=await s.xfs.statPromise(o);if(i.isFile()&&i.mtimeMs>n&&(n=i.mtimeMs),i.isDirectory()){const e=await B(o,t);e>n&&(n=e)}})),n},M=(e,t)=>{let n=Math.abs(t-e),r="";const o=Math.trunc(n/6e4);return o&&(r+=o+"m",n-=6e4*o),n&&(o&&(r+=" "),r+=(n/1e3).toFixed(2)+"s"),r};const L=class{constructor({project:e,report:t,runCommand:n,cli:r,configuration:i,pluginConfiguration:a,dryRun:u,ignoreRunCache:c,verbose:l}){this.runGraph=new E,this.runLength=0,this.runTargets=[],this.runMutexes={},this.dryRun=!1,this.ignoreRunCache=!1,this.verbose=!1,this.entrypoints=[],this.limit=C()(Math.max(1,(0,v.cpus)().length)),this.runReporter=new b.EventEmitter,this.runReport={mutex:new R.W,totalJobs:0,previousOutput:"",successCount:0,failCount:0,workspaces:{},done:!1},this.concurrency=Math.max(1,(0,v.cpus)().length),this.nextUnitOfWork=[],this.hasSetup=!1,this.setupRunReporter=()=>{this.runReporter.on(O.pending,(e,t)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[e]={name:t,stdout:[],stderr:[],done:!1,fail:!1},n()})}),this.runReporter.on(O.start,(e,t,n)=>{this.runReport.mutex.acquire().then(r=>{this.runReport.workspaces[e]=Object.assign(Object.assign({},this.runReport.workspaces[e]),{start:Date.now(),runScript:n,name:t}),r()})}),this.runReporter.on(O.info,(e,t)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[e].stdout.push(t),n()})}),this.runReporter.on(O.error,(e,t)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[e].stderr.push(t),this.logError(`${e} ${t}`),n()})}),this.runReporter.on(O.success,e=>{this.runReport.mutex.acquire().then(t=>{this.runReport.workspaces[e]=Object.assign(Object.assign({},this.runReport.workspaces[e]),{done:!0}),this.runReport.successCount++,t()})}),this.runReporter.on(O.fail,(e,t)=>{this.runReport.mutex.acquire().then(n=>{this.runReport.workspaces[e].stderr.push(t),this.runReport.workspaces[e].done=!0,this.runReport.workspaces[e].fail=!0,this.runReport.failCount++,this.logError(`${e} ${t}`),n()})})},this.plan=async e=>{var t,n,r,i,s;const a=this.runGraph.addNode(e.relativeCwd).addWorkSpace(e);let u=!1;this.runMutexes[e.relativeCwd]=new R.W;for(const t of o.Manifest.hardDependencies)for(const n of e.manifest.getForScope(t).values()){const e=this.project.tryWorkspaceByDescriptor(n);if(null===e)continue;const t=this.runGraph.addNode(e.relativeCwd).addWorkSpace(e);a.addDependency(t);const r=await this.plan(e);let o=!1;e!==this.project.topLevelWorkspace&&(o=await this.checkIfRunIsRequired(e)),(o||r)&&(u=!0,t.addRunCallback(this.createRunItem(e)))}let c=!1;if(e!==this.project.topLevelWorkspace&&(c=await this.checkIfRunIsRequired(e)),this.runReporter.emit(O.pending,e.relativeCwd),u||c)return this.runReporter.emit(O.pending,e.relativeCwd,`${(null===(t=e.manifest.name)||void 0===t?void 0:t.scope)?`@${null===(n=e.manifest.name)||void 0===n?void 0:n.scope}/`:""}${null===(r=e.manifest.name)||void 0===r?void 0:r.name}`),a.addRunCallback(this.createRunItem(e)),!0;{const t=null===(i=this.runLog)||void 0===i?void 0:i.get(`${e.relativeCwd}#${this.runCommand}`);t&&(null===(s=this.runLog)||void 0===s||s.set(`${e.relativeCwd}#${this.runCommand}`,{lastModified:t.lastModified,status:T.succeeded,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}))}return!1},this.run=async()=>{var e,t;if(!1===this.hasSetup)throw new Error("RunSupervisor is not setup, you need to call await supervisor.setup()");if(this.runReport.runStart=Date.now(),this.dryRun||m()||(j.pad(this.concurrency+3),this.raf(this.waitUntilDone)),this.dryRun)return;this.currentRunTarget=this.runTargets.length>1?"All":null!==(t=null===(e=this.runTargets[0])||void 0===e?void 0:e.relativeCwd)&&void 0!==t?t:"Nothing to run";const n=this.generateHeaderString();await this.runGraph.run(this.entrypoints);const r=await this.runReport.mutex.acquire();if(this.runReport.done=!0,r(),m()||(j.cursorUp(j.linesRequired(this.runReport.previousOutput,process.stdout.columns)),j.clearScreenDown()),0!==this.runReport.failCount){this.logError(n),process.stdout.write(n+"\n");for(const e in this.runReport.workspaces){const t=this.runReport.workspaces[e];if(0!==t.stdout.length){const n=`${this.configuration.format("➤","blueBright")} ${this.configuration.format("YN0009:","grey")} │ ┌ [stdout] for ${this.configuration.format(e,o.FormatType.PATH)}`;this.logError(n),process.stdout.write(n+"\n"),t.stdout.forEach(e=>{const t=e.split("\n");t.forEach((e,n)=>{if(0!==e.length){const r=`${this.configuration.format("➤","blueBright")} YN0009: │ ${t.length===n-1?"└":"│"} ${e}`;this.logError(r),process.stdout.write(r+"\n")}})});const r=`${this.configuration.format("➤","blueBright")} ${this.configuration.format("YN0009:","grey")} │ └ [stdout] ${this.configuration.format(e,o.FormatType.PATH)}`;this.logError(r),process.stdout.write(r+"\n")}if(0!==t.stderr.length){const n=`${this.configuration.format("➤","blueBright")} ${this.configuration.format("YN0009:","grey")} │ ┌ [stderr] ${this.configuration.format(e,o.FormatType.PATH)}`;this.logError(n),process.stderr.write(n+"\n"),t.stderr.forEach(e=>{const t=(e instanceof Error?e.toString():""+e).split("\n");t.forEach((e,n)=>{if(0!==e.length){const r=`${this.configuration.format("➤","blueBright")} YN0009: │ ${t.length===n-1?"└":"│"} ${e}`;this.logError(r),process.stderr.write(r+"\n")}})});const r=`${this.configuration.format("➤","blueBright")} ${this.configuration.format("YN0009:","grey")} │ └ [stderr] ${this.configuration.format(e,o.FormatType.PATH)}`;this.logError(r),process.stderr.write(r+"\n")}}}const i=this.generateFinalReport(0!==this.runReport.failCount);return process.stdout.write(i),this.logError(i),await this.saveRunLog(),0===this.runReport.failCount},this.raf=e=>{setImmediate(()=>e(Date.now()))},this.waitUntilDone=e=>{if(this.runReport.done)return;const t=this.generateProgressString(e);var n;j.cursorUp(j.linesRequired(this.runReport.previousOutput,process.stdout.columns)),j.clearScreenDown(),process.stdout.write(t),this.runReport.previousOutput=t,(n=90,new Promise(e=>setTimeout(e,n))).then(()=>{this.raf(this.waitUntilDone)})},this.generateRunCountString=e=>{const t=e=>this.configuration.format(e,"grey"),n=this.configuration.format("➤","blueBright"),r=t("YN0000:");let o="";if(this.runReport.runStart){const i=this.configuration.format(""+this.runReport.successCount,"green"),s=this.configuration.format(""+this.runReport.failCount,"red"),a=this.configuration.format(""+this.runGraph.runSize,"grey");o+=`${n} ${r} └ ${t("[")}${i}${t(":")}${s}${t("/")}${a}${t("]")} ${M(this.runReport.runStart,e)}\n`}return o},this.generateFinalReport=e=>{const t=e=>this.configuration.format(e,"grey"),n=this.configuration.format("➤","blueBright"),r=t("YN0000:");let o=`${n} ${r} ${e?"└":n} Run [ ${this.configuration.format(this.runCommand+" finished",0===this.runReport.failCount?"green":"red")}${0!=this.runReport.failCount?this.configuration.format(` with ${this.runReport.failCount} errors`,"red"):""} ]\n`;if(this.runReport.runStart){const e=this.configuration.format(""+this.runReport.successCount,"green"),i=this.configuration.format(""+this.runReport.failCount,"red"),s=this.configuration.format(""+this.runGraph.runSize,"grey");o+=`${n} ${r} ${t("[")}${e}${t(":")}${i}${t("/")}${s}${t("]")}\n`}return o},this.createRunItem=e=>async()=>await this.limit(async()=>{var t,n,r,o,i,s,a;const u=e.relativeCwd,c=e.manifest.scripts.get(this.runCommand),l=null===(t=this.runLog)||void 0===t?void 0:t.get(`${e.relativeCwd}#${this.runCommand}`);if(this.runReporter.emit(O.start,e.relativeCwd,`${(null===(n=e.manifest.name)||void 0===n?void 0:n.scope)?`@${null===(r=e.manifest.name)||void 0===r?void 0:r.scope}/`:""}${null===(o=e.manifest.name)||void 0===o?void 0:o.name}`,c),!c)return this.verbose&&this.runReporter.emit(O.info,e.relativeCwd,`Missing \`${this.runCommand}\` script in manifest.`),this.runReporter.emit(O.success,e.relativeCwd),!0;try{if(0!==await this.cli(this.runCommand,e.cwd,this.runReporter,u))return this.runReporter.emit(O.fail,e.relativeCwd),null===(i=this.runLog)||void 0===i||i.set(`${e.relativeCwd}#${this.runCommand}`,{lastModified:null==l?void 0:l.lastModified,status:T.failed,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),!1;null===(s=this.runLog)||void 0===s||s.set(`${e.relativeCwd}#${this.runCommand}`,{lastModified:null==l?void 0:l.lastModified,status:T.succeeded,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),this.runReporter.emit(O.success,e.relativeCwd)}catch(t){return this.runReporter.emit(O.fail,e.relativeCwd,t),null===(a=this.runLog)||void 0===a||a.set(`${e.relativeCwd}#${this.runCommand}`,{lastModified:null==l?void 0:l.lastModified,status:T.failed,haveCheckedForRerun:!0,rerun:!1,command:this.runCommand}),!1}return!0}),this.configuration=i,this.pluginConfiguration=a,this.project=e,this.report=t,this.runCommand=n,this.cli=r,this.dryRun=u,this.ignoreRunCache=c,this.verbose=l,this.queue=new y.Z({concurrency:this.concurrency,carryoverConcurrencyCount:!0,timeout:5e4,throwOnTimeout:!0,autoStart:!0}),this.verbose&&(this.errorLogFile=s.xfs.createWriteStream(this.getRunErrorPath(),{flags:"a"}))}async setup(){this.runLog=await this.readRunLog(),this.setupRunReporter(),this.hasSetup=!0}getRunErrorPath(){return s.ppath.resolve(this.project.cwd,"yarnBuild-error.log")}getRunLogPath(){return s.ppath.resolve(this.project.cwd,".yarn","yarn.build.json")}async readRunLog(){const e=new Map;try{const t=await s.xfs.readJsonPromise(this.getRunLogPath());if(t&&t.packages)for(const n in t.packages)e.set(n,{lastModified:t.packages[n].lastModified,status:t.packages[n].status,haveCheckedForRerun:!1,rerun:!0,command:this.runCommand})}catch(e){}return e}async saveRunLog(){if(!this.runLog)return;let e;try{e=await s.xfs.readJsonPromise(this.getRunLogPath())}catch(e){}const t={comment:"This is an auto-generated file, it keeps track of whats been built. This is a local file, don't store this in version control.",packages:Object.assign({},e&&e.packages)};for(const[e,n]of this.runLog)n.status===T.succeeded&&(t.packages[e]=Object.assign(Object.assign({},t.packages[e]),this.runLog.get(e)));await s.xfs.writeJsonPromise(this.getRunLogPath(),t)}logError(e){this.verbose&&this.errorLogFile&&this.errorLogFile.write("➤ YN0009: "+k()(e)+"\n"),m()&&process.stderr.write("➤ YN0009: "+k()(e)+"\n")}async addRunTarget(e){this.entrypoints.push(this.runGraph.addNode(e.relativeCwd));await this.plan(e)&&this.runTargets.push(e)}async checkIfRunIsRequired(e){var t,n,r,o,i;if(!0===this.ignoreRunCache)return!0;let a=!1;const u=s.ppath.resolve(e.project.cwd,e.relativeCwd);let l,d;this.pluginConfiguration.enableBetaFeatures.folderConfiguration&&((null===(t=null==e?void 0:e.manifest)||void 0===t?void 0:t.raw["yarn.build"])&&"string"==typeof(null==e?void 0:e.manifest.raw["yarn.build"].output)?l=`${u}${c().sep}${null==e?void 0:e.manifest.raw["yarn.build"].output}`:this.pluginConfiguration.folders.output?l=`${u}${c().sep}${this.pluginConfiguration.folders.output}`:(null==e?void 0:e.manifest.raw.main)&&(l=`${u}${c().sep}${null==e?void 0:e.manifest.raw.main.substring(0,null==e?void 0:e.manifest.raw.main.lastIndexOf(c().sep))}`),(null===(n=null==e?void 0:e.manifest)||void 0===n?void 0:n.raw["yarn.build"])&&"string"==typeof(null==e?void 0:e.manifest.raw["yarn.build"].input)?d=`${u}${c().sep}${null==e?void 0:e.manifest.raw["yarn.build"].input}`:this.pluginConfiguration.folders.input&&(d=`${u}${c().sep}${this.pluginConfiguration.folders.input}`)),(null==d?void 0:d.endsWith("/."))&&(d=d.substring(0,d.length-2));const h=await this.runReport.mutex.acquire();try{const t=null===(r=this.runLog)||void 0===r?void 0:r.get(`${e.relativeCwd}#${this.runCommand}`);if(null==t?void 0:t.haveCheckedForRerun)return null===(o=null==t?void 0:t.rerun)||void 0===o||o;const n=await B(null!=d?d:u,l);(null==t?void 0:t.lastModified)!==n&&(a=!0),null===(i=this.runLog)||void 0===i||i.set(`${e.relativeCwd}#${this.runCommand}`,{lastModified:n,status:a?T.succeeded:T.pending,haveCheckedForRerun:!0,rerun:a,command:this.runCommand})}catch(t){this.logError(`${e.relativeCwd}: failed to get lastModified (${t})`)}finally{h()}return a}generateHeaderString(){return`${this.configuration.format("➤","blueBright")} ${this.configuration.format("YN0000:","grey")} ┌ Run ${this.configuration.format(""+this.runCommand,o.FormatType.CODE)} for ${this.configuration.format(this.currentRunTarget?this.currentRunTarget:"",o.FormatType.SCOPE)}${this.dryRun?this.configuration.format(" --dry-run",o.FormatType.NAME):""}`}generateProgressString(e){const t=`${this.configuration.format("➤","blueBright")} ${this.configuration.format("YN0000:","grey")} │`;let n="";const r=e=>this.configuration.format(`[${e}]`,"grey"),i=this.configuration.format("IDLE","grey");n+=this.generateHeaderString()+"\n";let s=1;for(const i in this.runReport.workspaces){const a=this.runReport.workspaces[i];if(!a||!a.start||a.done)continue;const u=this.configuration.format(i,o.FormatType.PATH),c=this.configuration.format(`(${a.runScript})`,o.FormatType.REFERENCE),l=a.start?this.configuration.format(M(a.start,e),o.FormatType.RANGE):"",d=r(s++),h=" ".repeat(d.length-1),p=this.configuration.format(a.name,o.FormatType.NAME);let f=`${t} ${d} ${u}${p} ${c} ${l}\n`,g="",m="",v="";k()(f).length>=process.stdout.columns&&(g=`${t} ${d} ${u}${p}\n`,m=`${h} ${this.configuration.format(" └","grey")} ${c} ${l}\n`,k()(g).length>=process.stdout.columns&&(g=$()(`${t} ${d} ${u}\n`,0,process.stdout.columns),m=$()(`${h} ${this.configuration.format(" │","grey")} ${p}\n`,0,process.stdout.columns),v=$()(`${h} ${this.configuration.format(" └","grey")} ${c} ${l}\n`,0,process.stdout.columns)),f=g+m+v),n+=f}for(;s<this.concurrency+1;)n+=`${t} ${r(s++)} ${i}\n`;return this.runReport.runStart&&(n+=this.generateRunCountString(e)),n}},N=(e,t)=>{const n=[];for(const r of e.workspacesCwds){const e=t.workspacesByCwd.get(r);e&&n.push(e,...N(e,t))}return n},D=async({targetWorkspace:e,project:t,supervisor:n})=>{if(0!==e.workspacesCwds.size){const r=N(e,t);for(const e of r){for(const r of o.Manifest.hardDependencies)for(const o of e.manifest.getForScope(r).values()){const e=t.tryWorkspaceByDescriptor(o);null!==e&&await n.addRunTarget(e)}await n.addRunTarget(e)}await n.addRunTarget(e)}else await n.addRunTarget(e)};var U=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};class A extends r.BaseCommand{constructor(){super(...arguments),this.json=!1,this.buildCommand="build",this.parallel=!0,this.interlaced=!1,this.verbose=!1,this.dryRun=!1,this.ignoreBuildCache=!1,this.buildTarget=[],this.buildLog={}}async execute(){const e=await o.Configuration.find(this.context.cwd,this.context.plugins),t=await f(e);return(await o.StreamReport.start({configuration:e,json:this.json,stdout:this.context.stdout,includeLogs:!0},async n=>{let r=this.context.cwd;t.enableBetaFeatures.targetedBuilds&&"string"==typeof this.buildTarget[0]&&(r=`${e.projectCwd}${c().sep}${this.buildTarget[0]}`);const{project:i,workspace:s}=await o.Project.find(e,r),a=s||i.topLevelWorkspace,u=new L({project:i,configuration:e,pluginConfiguration:t,report:n,runCommand:this.buildCommand,cli:async(e,t,n,r)=>{const i=new o.miscUtils.BufferStream;i.on("data",e=>null==n?void 0:n.emit(O.info,r,e&&e.toString()));const s=new o.miscUtils.BufferStream;s.on("data",e=>null==n?void 0:n.emit(O.error,r,e&&e.toString()));try{const n=await this.cli.run(["run",e],{cwd:t,stdout:i,stderr:s})||0;return i.end(),s.end(),n}catch(e){i.end(),s.end()}return 2},dryRun:this.dryRun,ignoreRunCache:this.ignoreBuildCache,verbose:this.verbose});await u.setup(),await D({targetWorkspace:a,project:i,supervisor:u});!1===await u.run()&&n.reportError(o.MessageName.BUILD_FAILED,"Build failed")})).exitCode()}}A.usage=a.Command.Usage({category:"Build commands",description:"build a package and all its dependencies",details:'\n      In a monorepo with internal packages that depend on others, this command\n      will traverse the dependency graph and efficiently ensure, the packages\n      are built in the right order.\n\n      - If `-p,--parallel` and `-i,--interlaced` are both set, Yarn\n      will print the lines from the output as it receives them.\n      Parallel defaults to true.\n\n      If `-i,--interlaced` wasn\'t set, it would instead buffer the output\n      from each process and print the resulting buffers only after their\n      source processes have exited. Defaults to false.\n\n      If the `--json` flag is set the output will follow a JSON-stream output\n      also known as NDJSON (https://github.com/ndjson/ndjson-spec).\n\n      `-c,--build-command` is the command to be run in each package (if available), defaults to "build"\n    '}),U([a.Command.Boolean("--json")],A.prototype,"json",void 0),U([a.Command.String("-c,--build-command")],A.prototype,"buildCommand",void 0),U([a.Command.Boolean("-p,--parallel")],A.prototype,"parallel",void 0),U([a.Command.Boolean("-i,--interlaced")],A.prototype,"interlaced",void 0),U([a.Command.Boolean("-v,--verbose")],A.prototype,"verbose",void 0),U([a.Command.Boolean("-d,--dry-run")],A.prototype,"dryRun",void 0),U([a.Command.Boolean("--ignore-cache")],A.prototype,"ignoreBuildCache",void 0),U([a.Command.Rest()],A.prototype,"buildTarget",void 0),U([a.Command.Path("build")],A.prototype,"execute",null);var q=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};class F extends r.BaseCommand{constructor(){super(...arguments),this.json=!1,this.verbose=!1,this.ignoreTestCache=!1,this.runTarget=[],this.runLog={}}async execute(){const e=await o.Configuration.find(this.context.cwd,this.context.plugins),t=await f(e);return(await o.StreamReport.start({configuration:e,json:this.json,stdout:this.context.stdout,includeLogs:!0},async n=>{let r=this.context.cwd;t.enableBetaFeatures.targetedBuilds&&"string"==typeof this.runTarget[0]&&(r=`${e.projectCwd}${c().sep}${this.runTarget[0]}`);const{project:i,workspace:s}=await o.Project.find(e,r),a=s||i.topLevelWorkspace,u=new L({project:i,configuration:e,pluginConfiguration:t,report:n,runCommand:"test",cli:async(e,t,n,r)=>{const i=new o.miscUtils.BufferStream;i.on("data",e=>null==n?void 0:n.emit(O.info,r,e&&e.toString()));const s=new o.miscUtils.BufferStream;s.on("data",e=>null==n?void 0:n.emit(O.error,r,e&&e.toString()));try{const n=await this.cli.run(["run",e],{cwd:t,stdout:i,stderr:s})||0;return i.end(),s.end(),n}catch(e){i.end(),s.end()}return 2},dryRun:!1,ignoreRunCache:this.ignoreTestCache,verbose:this.verbose});await u.setup(),await D({targetWorkspace:a,project:i,supervisor:u});!1===await u.run()&&n.reportError(o.MessageName.BUILD_FAILED,"Test failed")})).exitCode()}}F.usage=a.Command.Usage({category:"Test commands",description:"test a package and all its dependencies",details:"\n      Run tests.\n\n    "}),q([a.Command.Boolean("--json")],F.prototype,"json",void 0),q([a.Command.Boolean("-v,--verbose")],F.prototype,"verbose",void 0),q([a.Command.Boolean("--ignore-cache")],F.prototype,"ignoreTestCache",void 0),q([a.Command.Rest()],F.prototype,"runTarget",void 0),q([a.Command.Path("test")],F.prototype,"execute",null);const z={commands:[d,A,F]}},461:e=>{"use strict";e.exports=({onlyFirst:e=!1}={})=>{const t=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(t,e?void 0:"g")}},101:(e,t,n)=>{"use strict";e=n.nmd(e);const r=(e,t)=>(...n)=>`[${e(...n)+t}m`,o=(e,t)=>(...n)=>{const r=e(...n);return`[${38+t};5;${r}m`},i=(e,t)=>(...n)=>{const r=e(...n);return`[${38+t};2;${r[0]};${r[1]};${r[2]}m`},s=e=>e,a=(e,t,n)=>[e,t,n],u=(e,t,n)=>{Object.defineProperty(e,t,{get:()=>{const r=n();return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0})};let c;const l=(e,t,r,o)=>{void 0===c&&(c=n(198));const i=o?10:0,s={};for(const[n,o]of Object.entries(c)){const a="ansi16"===n?"ansi":n;n===t?s[a]=e(r,i):"object"==typeof o&&(s[a]=e(o[t],i))}return s};Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){for(const[n,o]of Object.entries(r))t[n]={open:`[${o[0]}m`,close:`[${o[1]}m`},r[n]=t[n],e.set(o[0],o[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",u(t.color,"ansi",()=>l(r,"ansi16",s,!1)),u(t.color,"ansi256",()=>l(o,"ansi256",s,!1)),u(t.color,"ansi16m",()=>l(i,"rgb",a,!1)),u(t.bgColor,"ansi",()=>l(r,"ansi16",s,!0)),u(t.bgColor,"ansi256",()=>l(o,"ansi256",s,!0)),u(t.bgColor,"ansi16m",()=>l(i,"rgb",a,!0)),t}})},593:e=>{"use strict";e.exports=e=>e&&e.exact?new RegExp("^[\ud800-\udbff][\udc00-\udfff]$"):new RegExp("[\ud800-\udbff][\udc00-\udfff]","g")},344:(e,t)=>{"use strict";class n{constructor(e){this.tasks=[],this.count=e}sched(){if(this.count>0&&this.tasks.length>0){this.count--;let e=this.tasks.shift();if(void 0===e)throw"Unexpected undefined value in tasks list";e()}}acquire(){return new Promise((e,t)=>{this.tasks.push(()=>{var t=!1;e(()=>{t||(t=!0,this.count++,this.sched())})}),process&&process.nextTick?process.nextTick(this.sched.bind(this)):setImmediate(this.sched.bind(this))})}use(e){return this.acquire().then(t=>e().then(e=>(t(),e)).catch(e=>{throw t(),e}))}}t.W=class extends n{constructor(){super(1)}}},187:(e,t,n)=>{"use strict";var r=n(526),o=process.env;function i(e){return"string"==typeof e?!!o[e]:Object.keys(e).every((function(t){return o[t]===e[t]}))}Object.defineProperty(t,"_vendors",{value:r.map((function(e){return e.constant}))}),t.name=null,t.isPR=null,r.forEach((function(e){var n=(Array.isArray(e.env)?e.env:[e.env]).every((function(e){return i(e)}));if(t[e.constant]=n,n)switch(t.name=e.name,typeof e.pr){case"string":t.isPR=!!o[e.pr];break;case"object":"env"in e.pr?t.isPR=e.pr.env in o&&o[e.pr.env]!==e.pr.ne:"any"in e.pr?t.isPR=e.pr.any.some((function(e){return!!o[e]})):t.isPR=i(e.pr);break;default:t.isPR=null}})),t.isCI=!!(o.CI||o.CONTINUOUS_INTEGRATION||o.BUILD_NUMBER||o.RUN_ID||t.name)},526:e=>{"use strict";e.exports=JSON.parse('[{"name":"AppVeyor","constant":"APPVEYOR","env":"APPVEYOR","pr":"APPVEYOR_PULL_REQUEST_NUMBER"},{"name":"Azure Pipelines","constant":"AZURE_PIPELINES","env":"SYSTEM_TEAMFOUNDATIONCOLLECTIONURI","pr":"SYSTEM_PULLREQUEST_PULLREQUESTID"},{"name":"Bamboo","constant":"BAMBOO","env":"bamboo_planKey"},{"name":"Bitbucket Pipelines","constant":"BITBUCKET","env":"BITBUCKET_COMMIT","pr":"BITBUCKET_PR_ID"},{"name":"Bitrise","constant":"BITRISE","env":"BITRISE_IO","pr":"BITRISE_PULL_REQUEST"},{"name":"Buddy","constant":"BUDDY","env":"BUDDY_WORKSPACE_ID","pr":"BUDDY_EXECUTION_PULL_REQUEST_ID"},{"name":"Buildkite","constant":"BUILDKITE","env":"BUILDKITE","pr":{"env":"BUILDKITE_PULL_REQUEST","ne":"false"}},{"name":"CircleCI","constant":"CIRCLE","env":"CIRCLECI","pr":"CIRCLE_PULL_REQUEST"},{"name":"Cirrus CI","constant":"CIRRUS","env":"CIRRUS_CI","pr":"CIRRUS_PR"},{"name":"AWS CodeBuild","constant":"CODEBUILD","env":"CODEBUILD_BUILD_ARN"},{"name":"Codeship","constant":"CODESHIP","env":{"CI_NAME":"codeship"}},{"name":"Drone","constant":"DRONE","env":"DRONE","pr":{"DRONE_BUILD_EVENT":"pull_request"}},{"name":"dsari","constant":"DSARI","env":"DSARI"},{"name":"GitLab CI","constant":"GITLAB","env":"GITLAB_CI"},{"name":"GoCD","constant":"GOCD","env":"GO_PIPELINE_LABEL"},{"name":"Hudson","constant":"HUDSON","env":"HUDSON_URL"},{"name":"Jenkins","constant":"JENKINS","env":["JENKINS_URL","BUILD_ID"],"pr":{"any":["ghprbPullId","CHANGE_ID"]}},{"name":"Magnum CI","constant":"MAGNUM","env":"MAGNUM"},{"name":"Netlify CI","constant":"NETLIFY","env":"NETLIFY_BUILD_BASE","pr":{"env":"PULL_REQUEST","ne":"false"}},{"name":"Sail CI","constant":"SAIL","env":"SAILCI","pr":"SAIL_PULL_REQUEST_NUMBER"},{"name":"Semaphore","constant":"SEMAPHORE","env":"SEMAPHORE","pr":"PULL_REQUEST_NUMBER"},{"name":"Shippable","constant":"SHIPPABLE","env":"SHIPPABLE","pr":{"IS_PULL_REQUEST":"true"}},{"name":"Solano CI","constant":"SOLANO","env":"TDDIUM","pr":"TDDIUM_PR_ID"},{"name":"Strider CD","constant":"STRIDER","env":"STRIDER"},{"name":"TaskCluster","constant":"TASKCLUSTER","env":["TASK_ID","RUN_ID"]},{"name":"TeamCity","constant":"TEAMCITY","env":"TEAMCITY_VERSION"},{"name":"Travis CI","constant":"TRAVIS","env":"TRAVIS","pr":{"env":"TRAVIS_PULL_REQUEST","ne":"false"}}]')},244:(e,t,n)=>{const r=n(752),o={};for(const e of Object.keys(r))o[r[e]]=e;const i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=i;for(const e of Object.keys(i)){if(!("channels"in i[e]))throw new Error("missing channels property: "+e);if(!("labels"in i[e]))throw new Error("missing channel labels property: "+e);if(i[e].labels.length!==i[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:t,labels:n}=i[e];delete i[e].channels,delete i[e].labels,Object.defineProperty(i[e],"channels",{value:t}),Object.defineProperty(i[e],"labels",{value:n})}i.rgb.hsl=function(e){const t=e[0]/255,n=e[1]/255,r=e[2]/255,o=Math.min(t,n,r),i=Math.max(t,n,r),s=i-o;let a,u;i===o?a=0:t===i?a=(n-r)/s:n===i?a=2+(r-t)/s:r===i&&(a=4+(t-n)/s),a=Math.min(60*a,360),a<0&&(a+=360);const c=(o+i)/2;return u=i===o?0:c<=.5?s/(i+o):s/(2-i-o),[a,100*u,100*c]},i.rgb.hsv=function(e){let t,n,r,o,i;const s=e[0]/255,a=e[1]/255,u=e[2]/255,c=Math.max(s,a,u),l=c-Math.min(s,a,u),d=function(e){return(c-e)/6/l+.5};return 0===l?(o=0,i=0):(i=l/c,t=d(s),n=d(a),r=d(u),s===c?o=r-n:a===c?o=1/3+t-r:u===c&&(o=2/3+n-t),o<0?o+=1:o>1&&(o-=1)),[360*o,100*i,100*c]},i.rgb.hwb=function(e){const t=e[0],n=e[1];let r=e[2];const o=i.rgb.hsl(e)[0],s=1/255*Math.min(t,Math.min(n,r));return r=1-1/255*Math.max(t,Math.max(n,r)),[o,100*s,100*r]},i.rgb.cmyk=function(e){const t=e[0]/255,n=e[1]/255,r=e[2]/255,o=Math.min(1-t,1-n,1-r);return[100*((1-t-o)/(1-o)||0),100*((1-n-o)/(1-o)||0),100*((1-r-o)/(1-o)||0),100*o]},i.rgb.keyword=function(e){const t=o[e];if(t)return t;let n,i=1/0;for(const t of Object.keys(r)){const o=r[t],u=(a=o,((s=e)[0]-a[0])**2+(s[1]-a[1])**2+(s[2]-a[2])**2);u<i&&(i=u,n=t)}var s,a;return n},i.keyword.rgb=function(e){return r[e]},i.rgb.xyz=function(e){let t=e[0]/255,n=e[1]/255,r=e[2]/255;t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,r=r>.04045?((r+.055)/1.055)**2.4:r/12.92;return[100*(.4124*t+.3576*n+.1805*r),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]},i.rgb.lab=function(e){const t=i.rgb.xyz(e);let n=t[0],r=t[1],o=t[2];n/=95.047,r/=100,o/=108.883,n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*r-16,500*(n-r),200*(r-o)]},i.hsl.rgb=function(e){const t=e[0]/360,n=e[1]/100,r=e[2]/100;let o,i,s;if(0===n)return s=255*r,[s,s,s];o=r<.5?r*(1+n):r+n-r*n;const a=2*r-o,u=[0,0,0];for(let e=0;e<3;e++)i=t+1/3*-(e-1),i<0&&i++,i>1&&i--,s=6*i<1?a+6*(o-a)*i:2*i<1?o:3*i<2?a+(o-a)*(2/3-i)*6:a,u[e]=255*s;return u},i.hsl.hsv=function(e){const t=e[0];let n=e[1]/100,r=e[2]/100,o=n;const i=Math.max(r,.01);r*=2,n*=r<=1?r:2-r,o*=i<=1?i:2-i;return[t,100*(0===r?2*o/(i+o):2*n/(r+n)),100*((r+n)/2)]},i.hsv.rgb=function(e){const t=e[0]/60,n=e[1]/100;let r=e[2]/100;const o=Math.floor(t)%6,i=t-Math.floor(t),s=255*r*(1-n),a=255*r*(1-n*i),u=255*r*(1-n*(1-i));switch(r*=255,o){case 0:return[r,u,s];case 1:return[a,r,s];case 2:return[s,r,u];case 3:return[s,a,r];case 4:return[u,s,r];case 5:return[r,s,a]}},i.hsv.hsl=function(e){const t=e[0],n=e[1]/100,r=e[2]/100,o=Math.max(r,.01);let i,s;s=(2-n)*r;const a=(2-n)*o;return i=n*o,i/=a<=1?a:2-a,i=i||0,s/=2,[t,100*i,100*s]},i.hwb.rgb=function(e){const t=e[0]/360;let n=e[1]/100,r=e[2]/100;const o=n+r;let i;o>1&&(n/=o,r/=o);const s=Math.floor(6*t),a=1-r;i=6*t-s,0!=(1&s)&&(i=1-i);const u=n+i*(a-n);let c,l,d;switch(s){default:case 6:case 0:c=a,l=u,d=n;break;case 1:c=u,l=a,d=n;break;case 2:c=n,l=a,d=u;break;case 3:c=n,l=u,d=a;break;case 4:c=u,l=n,d=a;break;case 5:c=a,l=n,d=u}return[255*c,255*l,255*d]},i.cmyk.rgb=function(e){const t=e[0]/100,n=e[1]/100,r=e[2]/100,o=e[3]/100;return[255*(1-Math.min(1,t*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o)),255*(1-Math.min(1,r*(1-o)+o))]},i.xyz.rgb=function(e){const t=e[0]/100,n=e[1]/100,r=e[2]/100;let o,i,s;return o=3.2406*t+-1.5372*n+-.4986*r,i=-.9689*t+1.8758*n+.0415*r,s=.0557*t+-.204*n+1.057*r,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,o=Math.min(Math.max(0,o),1),i=Math.min(Math.max(0,i),1),s=Math.min(Math.max(0,s),1),[255*o,255*i,255*s]},i.xyz.lab=function(e){let t=e[0],n=e[1],r=e[2];t/=95.047,n/=100,r/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116;return[116*n-16,500*(t-n),200*(n-r)]},i.lab.xyz=function(e){let t,n,r;n=(e[0]+16)/116,t=e[1]/500+n,r=n-e[2]/200;const o=n**3,i=t**3,s=r**3;return n=o>.008856?o:(n-16/116)/7.787,t=i>.008856?i:(t-16/116)/7.787,r=s>.008856?s:(r-16/116)/7.787,t*=95.047,n*=100,r*=108.883,[t,n,r]},i.lab.lch=function(e){const t=e[0],n=e[1],r=e[2];let o;o=360*Math.atan2(r,n)/2/Math.PI,o<0&&(o+=360);return[t,Math.sqrt(n*n+r*r),o]},i.lch.lab=function(e){const t=e[0],n=e[1],r=e[2]/360*2*Math.PI;return[t,n*Math.cos(r),n*Math.sin(r)]},i.rgb.ansi16=function(e,t=null){const[n,r,o]=e;let s=null===t?i.rgb.hsv(e)[2]:t;if(s=Math.round(s/50),0===s)return 30;let a=30+(Math.round(o/255)<<2|Math.round(r/255)<<1|Math.round(n/255));return 2===s&&(a+=60),a},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){const t=e[0],n=e[1],r=e[2];if(t===n&&n===r)return t<8?16:t>248?231:Math.round((t-8)/247*24)+232;return 16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},i.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const n=.5*(1+~~(e>50));return[(1&t)*n*255,(t>>1&1)*n*255,(t>>2&1)*n*255]},i.ansi256.rgb=function(e){if(e>=232){const t=10*(e-232)+8;return[t,t,t]}let t;e-=16;return[Math.floor(e/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},i.rgb.hex=function(e){const t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){const t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let n=t[0];3===t[0].length&&(n=n.split("").map(e=>e+e).join(""));const r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},i.rgb.hcg=function(e){const t=e[0]/255,n=e[1]/255,r=e[2]/255,o=Math.max(Math.max(t,n),r),i=Math.min(Math.min(t,n),r),s=o-i;let a,u;return a=s<1?i/(1-s):0,u=s<=0?0:o===t?(n-r)/s%6:o===n?2+(r-t)/s:4+(t-n)/s,u/=6,u%=1,[360*u,100*s,100*a]},i.hsl.hcg=function(e){const t=e[1]/100,n=e[2]/100,r=n<.5?2*t*n:2*t*(1-n);let o=0;return r<1&&(o=(n-.5*r)/(1-r)),[e[0],100*r,100*o]},i.hsv.hcg=function(e){const t=e[1]/100,n=e[2]/100,r=t*n;let o=0;return r<1&&(o=(n-r)/(1-r)),[e[0],100*r,100*o]},i.hcg.rgb=function(e){const t=e[0]/360,n=e[1]/100,r=e[2]/100;if(0===n)return[255*r,255*r,255*r];const o=[0,0,0],i=t%1*6,s=i%1,a=1-s;let u=0;switch(Math.floor(i)){case 0:o[0]=1,o[1]=s,o[2]=0;break;case 1:o[0]=a,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=s;break;case 3:o[0]=0,o[1]=a,o[2]=1;break;case 4:o[0]=s,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=a}return u=(1-n)*r,[255*(n*o[0]+u),255*(n*o[1]+u),255*(n*o[2]+u)]},i.hcg.hsv=function(e){const t=e[1]/100,n=t+e[2]/100*(1-t);let r=0;return n>0&&(r=t/n),[e[0],100*r,100*n]},i.hcg.hsl=function(e){const t=e[1]/100,n=e[2]/100*(1-t)+.5*t;let r=0;return n>0&&n<.5?r=t/(2*n):n>=.5&&n<1&&(r=t/(2*(1-n))),[e[0],100*r,100*n]},i.hcg.hwb=function(e){const t=e[1]/100,n=t+e[2]/100*(1-t);return[e[0],100*(n-t),100*(1-n)]},i.hwb.hcg=function(e){const t=e[1]/100,n=1-e[2]/100,r=n-t;let o=0;return r<1&&(o=(n-r)/(1-r)),[e[0],100*r,100*o]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=function(e){return[0,0,e[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){const t=255&Math.round(e[0]/100*255),n=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(n.length)+n},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},198:(e,t,n)=>{const r=n(244),o=n(350),i={};Object.keys(r).forEach(e=>{i[e]={},Object.defineProperty(i[e],"channels",{value:r[e].channels}),Object.defineProperty(i[e],"labels",{value:r[e].labels});const t=o(e);Object.keys(t).forEach(n=>{const r=t[n];i[e][n]=function(e){const t=function(...t){const n=t[0];if(null==n)return n;n.length>1&&(t=n);const r=e(t);if("object"==typeof r)for(let e=r.length,t=0;t<e;t++)r[t]=Math.round(r[t]);return r};return"conversion"in e&&(t.conversion=e.conversion),t}(r),i[e][n].raw=function(e){const t=function(...t){const n=t[0];return null==n?n:(n.length>1&&(t=n),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)})}),e.exports=i},350:(e,t,n)=>{const r=n(244);function o(e){const t=function(){const e={},t=Object.keys(r);for(let n=t.length,r=0;r<n;r++)e[t[r]]={distance:-1,parent:null};return e}(),n=[e];for(t[e].distance=0;n.length;){const e=n.pop(),o=Object.keys(r[e]);for(let r=o.length,i=0;i<r;i++){const r=o[i],s=t[r];-1===s.distance&&(s.distance=t[e].distance+1,s.parent=e,n.unshift(r))}}return t}function i(e,t){return function(n){return t(e(n))}}function s(e,t){const n=[t[e].parent,e];let o=r[t[e].parent][e],s=t[e].parent;for(;t[s].parent;)n.unshift(t[s].parent),o=i(r[t[s].parent][s],o),s=t[s].parent;return o.conversion=n,o}e.exports=function(e){const t=o(e),n={},r=Object.keys(t);for(let e=r.length,o=0;o<e;o++){const e=r[o];null!==t[e].parent&&(n[e]=s(e,t))}return n}},752:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},178:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,i||e,s),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,o,i,s){var a=n?n+e:e;if(!this._events[a])return!1;var u,c,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,o),!0;case 5:return l.fn.call(l.context,t,r,o,i),!0;case 6:return l.fn.call(l.context,t,r,o,i,s),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,o);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},a.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||o&&!a.once||r&&a.context!==r||s(this,i);else{for(var u=0,c=[],l=a.length;u<l;u++)(a[u].fn!==t||o&&!a[u].once||r&&a[u].context!==r)&&c.push(a[u]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},820:(e,t,n)=>{"use strict";e.exports=n(187).isCI},427:e=>{"use strict";const t=e=>!Number.isNaN(e)&&(e>=4352&&(e<=4447||9001===e||9002===e||11904<=e&&e<=12871&&12351!==e||12880<=e&&e<=19903||19968<=e&&e<=42182||43360<=e&&e<=43388||44032<=e&&e<=55203||63744<=e&&e<=64255||65040<=e&&e<=65049||65072<=e&&e<=65131||65281<=e&&e<=65376||65504<=e&&e<=65510||110592<=e&&e<=110593||127488<=e&&e<=127569||131072<=e&&e<=262141));e.exports=t,e.exports.default=t},473:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},299:(e,t,n)=>{"use strict";const r=n(679),o=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const t=[];let n=0;const o=()=>{n--,t.length>0&&t.shift()()},i=(e,t,...i)=>{n++;const s=r(e,...i);t(s),s.then(o,o)},s=(r,...o)=>new Promise(s=>((r,o,...s)=>{n<e?i(r,o,...s):t.push(i.bind(null,r,o,...s))})(r,s,...o));return Object.defineProperties(s,{activeCount:{get:()=>n},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),s};e.exports=o,e.exports.default=o},103:(e,t,n)=>{"use strict";const r=n(178),o=n(688),i=n(443),s=()=>{},a=new o.TimeoutError;t.Z=class extends r{constructor(e){if(super(),Object.defineProperty(this,"_carryoverConcurrencyCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isIntervalIgnored",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_intervalCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_intervalCap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_intervalEnd",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_intervalId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_timeoutId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queueClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pendingCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_concurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isPaused",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_resolveEmpty",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_resolveIdle",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_throwOnTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother()}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s)}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother)return this.emit("active"),this._queue.dequeue()(),e&&this._initializeIntervalIfNeeded(),!0}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,r)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():o.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(a)});n(await i)}catch(e){r(e)}this._next()},t),this._tryToStartAnother()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}set timeout(e){this._timeout=e}get timeout(){return this._timeout}}},310:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=0,o=e.length;for(;o>0;){const i=o/2|0;let s=r+i;n(e[s],t)<=0?(r=++s,o-=i+1):o=i}return r}},443:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(310);t.default=class{constructor(){Object.defineProperty(this,"_queue",{enumerable:!0,configurable:!0,writable:!0,value:[]})}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const o=r.default(this._queue,n,(e,t)=>t.priority-e.priority);this._queue.splice(o,0,n)}dequeue(){const e=this._queue.shift();return e&&e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},688:(e,t,n)=>{"use strict";const r=n(473);class o extends Error{constructor(e){super(e),this.name="TimeoutError"}}const i=(e,t,n)=>new Promise((i,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void i(e);const a=setTimeout(()=>{if("function"==typeof n){try{i(n())}catch(e){s(e)}return}const r=n instanceof Error?n:new o("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(r)},t);r(e.then(i,s),()=>{clearTimeout(a)})});e.exports=i,e.exports.default=i,e.exports.TimeoutError=o},679:e=>{"use strict";const t=(e,...t)=>new Promise(n=>{n(e(...t))});e.exports=t,e.exports.default=t},285:(e,t,n)=>{"use strict";const r=n(427),o=n(593),i=n(101),s=["",""],a=e=>`${s[0]}[${e}m`,u=(e,t,n)=>{let r=[];e=[...e];for(let n of e){const o=n;n.includes(";")&&(n=n.split(";")[0][0]+"0");const s=i.codes.get(Number.parseInt(n,10));if(s){const n=e.indexOf(s.toString());-1===n?r.push(a(t?s:o)):e.splice(n,1)}else{if(t){r.push(a(0));break}r.push(a(o))}}if(t&&(r=r.filter((e,t)=>r.indexOf(e)===t),void 0!==n)){const e=a(i.codes.get(Number.parseInt(n,10)));r=r.reduce((t,n)=>n===e?[n,...t]:[...t,n],[])}return r.join("")};e.exports=(e,t,n)=>{const i=[...e],a=[];let c,l="number"==typeof n?n:i.length,d=!1,h=0,p="";for(const[f,g]of i.entries()){let i=!1;if(s.includes(g)){const t=/\d[^m]*/.exec(e.slice(f,f+18));c=t&&t.length>0?t[0]:void 0,h<l&&(d=!0,void 0!==c&&a.push(c))}else d&&"m"===g&&(d=!1,i=!0);if(d||i||h++,!o({exact:!0}).test(g)&&r(g.codePointAt())&&(h++,"number"!=typeof n&&l++),h>t&&h<=l)p+=g;else if(h!==t||d||void 0===c){if(h>=l){p+=u(a,!0,c);break}}else p=u(a)}return p}},106:(e,t,n)=>{"use strict";const r=n(461);e.exports=e=>"string"==typeof e?e.replace(r(),""):e}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r](o,o.exports,n),o.loaded=!0,o.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(998)})();
return plugin;
}
};